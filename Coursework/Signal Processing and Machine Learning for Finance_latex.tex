\documentclass[11pt]{article}

    \usepackage[breakable]{tcolorbox}
    \usepackage{parskip} % Stop auto-indenting (to mimic markdown behaviour)
    
    \usepackage{iftex}
    \ifPDFTeX
    	\usepackage[T1]{fontenc}
    	\usepackage{mathpazo}
    \else
    	\usepackage{fontspec}
    \fi

    % Basic figure setup, for now with no caption control since it's done
    % automatically by Pandoc (which extracts ![](path) syntax from Markdown).
    \usepackage{graphicx}
    % Maintain compatibility with old templates. Remove in nbconvert 6.0
    \let\Oldincludegraphics\includegraphics
    % Ensure that by default, figures have no caption (until we provide a
    % proper Figure object with a Caption API and a way to capture that
    % in the conversion process - todo).
    \usepackage{caption}
    \DeclareCaptionFormat{nocaption}{}
    \captionsetup{format=nocaption,aboveskip=0pt,belowskip=0pt}

    \usepackage{float}
    \floatplacement{figure}{H} % forces figures to be placed at the correct location
    \usepackage{xcolor} % Allow colors to be defined
    \usepackage{enumerate} % Needed for markdown enumerations to work
    \usepackage{geometry} % Used to adjust the document margins
    \usepackage{amsmath} % Equations
    \usepackage{amssymb} % Equations
    \usepackage{textcomp} % defines textquotesingle
    % Hack from http://tex.stackexchange.com/a/47451/13684:
    \AtBeginDocument{%
        \def\PYZsq{\textquotesingle}% Upright quotes in Pygmentized code
    }
    \usepackage{upquote} % Upright quotes for verbatim code
    \usepackage{eurosym} % defines \euro
    \usepackage[mathletters]{ucs} % Extended unicode (utf-8) support
    \usepackage{fancyvrb} % verbatim replacement that allows latex
    \usepackage{grffile} % extends the file name processing of package graphics 
                         % to support a larger range
    \makeatletter % fix for old versions of grffile with XeLaTeX
    \@ifpackagelater{grffile}{2019/11/01}
    {
      % Do nothing on new versions
    }
    {
      \def\Gread@@xetex#1{%
        \IfFileExists{"\Gin@base".bb}%
        {\Gread@eps{\Gin@base.bb}}%
        {\Gread@@xetex@aux#1}%
      }
    }
    \makeatother
    \usepackage[Export]{adjustbox} % Used to constrain images to a maximum size
    \adjustboxset{max size={0.9\linewidth}{0.9\paperheight}}

    % The hyperref package gives us a pdf with properly built
    % internal navigation ('pdf bookmarks' for the table of contents,
    % internal cross-reference links, web links for URLs, etc.)
    \usepackage{hyperref}
    % The default LaTeX title has an obnoxious amount of whitespace. By default,
    % titling removes some of it. It also provides customization options.
    \usepackage{titling}
    \usepackage{longtable} % longtable support required by pandoc >1.10
    \usepackage{booktabs}  % table support for pandoc > 1.12.2
    \usepackage[inline]{enumitem} % IRkernel/repr support (it uses the enumerate* environment)
    \usepackage[normalem]{ulem} % ulem is needed to support strikethroughs (\sout)
                                % normalem makes italics be italics, not underlines
    \usepackage{mathrsfs}
    

    
    % Colors for the hyperref package
    \definecolor{urlcolor}{rgb}{0,.145,.698}
    \definecolor{linkcolor}{rgb}{.71,0.21,0.01}
    \definecolor{citecolor}{rgb}{.12,.54,.11}

    % ANSI colors
    \definecolor{ansi-black}{HTML}{3E424D}
    \definecolor{ansi-black-intense}{HTML}{282C36}
    \definecolor{ansi-red}{HTML}{E75C58}
    \definecolor{ansi-red-intense}{HTML}{B22B31}
    \definecolor{ansi-green}{HTML}{00A250}
    \definecolor{ansi-green-intense}{HTML}{007427}
    \definecolor{ansi-yellow}{HTML}{DDB62B}
    \definecolor{ansi-yellow-intense}{HTML}{B27D12}
    \definecolor{ansi-blue}{HTML}{208FFB}
    \definecolor{ansi-blue-intense}{HTML}{0065CA}
    \definecolor{ansi-magenta}{HTML}{D160C4}
    \definecolor{ansi-magenta-intense}{HTML}{A03196}
    \definecolor{ansi-cyan}{HTML}{60C6C8}
    \definecolor{ansi-cyan-intense}{HTML}{258F8F}
    \definecolor{ansi-white}{HTML}{C5C1B4}
    \definecolor{ansi-white-intense}{HTML}{A1A6B2}
    \definecolor{ansi-default-inverse-fg}{HTML}{FFFFFF}
    \definecolor{ansi-default-inverse-bg}{HTML}{000000}

    % common color for the border for error outputs.
    \definecolor{outerrorbackground}{HTML}{FFDFDF}

    % commands and environments needed by pandoc snippets
    % extracted from the output of `pandoc -s`
    \providecommand{\tightlist}{%
      \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
    \DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
    % Add ',fontsize=\small' for more characters per line
    \newenvironment{Shaded}{}{}
    \newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.56,0.13,0.00}{{#1}}}
    \newcommand{\DecValTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\FloatTok}[1]{\textcolor[rgb]{0.25,0.63,0.44}{{#1}}}
    \newcommand{\CharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\StringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\CommentTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textit{{#1}}}}
    \newcommand{\OtherTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{{#1}}}
    \newcommand{\AlertTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.02,0.16,0.49}{{#1}}}
    \newcommand{\RegionMarkerTok}[1]{{#1}}
    \newcommand{\ErrorTok}[1]{\textcolor[rgb]{1.00,0.00,0.00}{\textbf{{#1}}}}
    \newcommand{\NormalTok}[1]{{#1}}
    
    % Additional commands for more recent versions of Pandoc
    \newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.53,0.00,0.00}{{#1}}}
    \newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.25,0.44,0.63}{{#1}}}
    \newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.73,0.40,0.53}{{#1}}}
    \newcommand{\ImportTok}[1]{{#1}}
    \newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.73,0.13,0.13}{\textit{{#1}}}}
    \newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\VariableTok}[1]{\textcolor[rgb]{0.10,0.09,0.49}{{#1}}}
    \newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.00,0.44,0.13}{\textbf{{#1}}}}
    \newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.40,0.40,0.40}{{#1}}}
    \newcommand{\BuiltInTok}[1]{{#1}}
    \newcommand{\ExtensionTok}[1]{{#1}}
    \newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.74,0.48,0.00}{{#1}}}
    \newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.49,0.56,0.16}{{#1}}}
    \newcommand{\InformationTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    \newcommand{\WarningTok}[1]{\textcolor[rgb]{0.38,0.63,0.69}{\textbf{\textit{{#1}}}}}
    
    
    % Define a nice break command that doesn't care if a line doesn't already
    % exist.
    \def\br{\hspace*{\fill} \\* }
    % Math Jax compatibility definitions
    \def\gt{>}
    \def\lt{<}
    \let\Oldtex\TeX
    \let\Oldlatex\LaTeX
    \renewcommand{\TeX}{\textrm{\Oldtex}}
    \renewcommand{\LaTeX}{\textrm{\Oldlatex}}
    % Document parameters
    % Document title
    \title{Signal Processing and Machine Learning for Finance\_latex}
    
    
    
    
    
% Pygments definitions
\makeatletter
\def\PY@reset{\let\PY@it=\relax \let\PY@bf=\relax%
    \let\PY@ul=\relax \let\PY@tc=\relax%
    \let\PY@bc=\relax \let\PY@ff=\relax}
\def\PY@tok#1{\csname PY@tok@#1\endcsname}
\def\PY@toks#1+{\ifx\relax#1\empty\else%
    \PY@tok{#1}\expandafter\PY@toks\fi}
\def\PY@do#1{\PY@bc{\PY@tc{\PY@ul{%
    \PY@it{\PY@bf{\PY@ff{#1}}}}}}}
\def\PY#1#2{\PY@reset\PY@toks#1+\relax+\PY@do{#2}}

\@namedef{PY@tok@w}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.73,0.73}{##1}}}
\@namedef{PY@tok@c}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\@namedef{PY@tok@cp}{\def\PY@tc##1{\textcolor[rgb]{0.74,0.48,0.00}{##1}}}
\@namedef{PY@tok@k}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kt}{\def\PY@tc##1{\textcolor[rgb]{0.69,0.00,0.25}{##1}}}
\@namedef{PY@tok@o}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ow}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@nb}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nf}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@nn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@ne}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.82,0.25,0.23}{##1}}}
\@namedef{PY@tok@nv}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@no}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.00,0.00}{##1}}}
\@namedef{PY@tok@nl}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.63,0.00}{##1}}}
\@namedef{PY@tok@ni}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.60,0.60,0.60}{##1}}}
\@namedef{PY@tok@na}{\def\PY@tc##1{\textcolor[rgb]{0.49,0.56,0.16}{##1}}}
\@namedef{PY@tok@nt}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@nd}{\def\PY@tc##1{\textcolor[rgb]{0.67,0.13,1.00}{##1}}}
\@namedef{PY@tok@s}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sd}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@si}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\@namedef{PY@tok@se}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.13}{##1}}}
\@namedef{PY@tok@sr}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.40,0.53}{##1}}}
\@namedef{PY@tok@ss}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sx}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@m}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@gh}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@gu}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.50,0.00,0.50}{##1}}}
\@namedef{PY@tok@gd}{\def\PY@tc##1{\textcolor[rgb]{0.63,0.00,0.00}{##1}}}
\@namedef{PY@tok@gi}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.63,0.00}{##1}}}
\@namedef{PY@tok@gr}{\def\PY@tc##1{\textcolor[rgb]{1.00,0.00,0.00}{##1}}}
\@namedef{PY@tok@ge}{\let\PY@it=\textit}
\@namedef{PY@tok@gs}{\let\PY@bf=\textbf}
\@namedef{PY@tok@gp}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,0.50}{##1}}}
\@namedef{PY@tok@go}{\def\PY@tc##1{\textcolor[rgb]{0.53,0.53,0.53}{##1}}}
\@namedef{PY@tok@gt}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.27,0.87}{##1}}}
\@namedef{PY@tok@err}{\def\PY@bc##1{{\setlength{\fboxsep}{\string -\fboxrule}\fcolorbox[rgb]{1.00,0.00,0.00}{1,1,1}{\strut ##1}}}}
\@namedef{PY@tok@kc}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kd}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kn}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@kr}{\let\PY@bf=\textbf\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@bp}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.50,0.00}{##1}}}
\@namedef{PY@tok@fm}{\def\PY@tc##1{\textcolor[rgb]{0.00,0.00,1.00}{##1}}}
\@namedef{PY@tok@vc}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vg}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vi}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@vm}{\def\PY@tc##1{\textcolor[rgb]{0.10,0.09,0.49}{##1}}}
\@namedef{PY@tok@sa}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sb}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sc}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@dl}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s2}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@sh}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@s1}{\def\PY@tc##1{\textcolor[rgb]{0.73,0.13,0.13}{##1}}}
\@namedef{PY@tok@mb}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mf}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mh}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mi}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@il}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@mo}{\def\PY@tc##1{\textcolor[rgb]{0.40,0.40,0.40}{##1}}}
\@namedef{PY@tok@ch}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\@namedef{PY@tok@cm}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\@namedef{PY@tok@cpf}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\@namedef{PY@tok@c1}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}
\@namedef{PY@tok@cs}{\let\PY@it=\textit\def\PY@tc##1{\textcolor[rgb]{0.25,0.50,0.50}{##1}}}

\def\PYZbs{\char`\\}
\def\PYZus{\char`\_}
\def\PYZob{\char`\{}
\def\PYZcb{\char`\}}
\def\PYZca{\char`\^}
\def\PYZam{\char`\&}
\def\PYZlt{\char`\<}
\def\PYZgt{\char`\>}
\def\PYZsh{\char`\#}
\def\PYZpc{\char`\%}
\def\PYZdl{\char`\$}
\def\PYZhy{\char`\-}
\def\PYZsq{\char`\'}
\def\PYZdq{\char`\"}
\def\PYZti{\char`\~}
% for compatibility with earlier versions
\def\PYZat{@}
\def\PYZlb{[}
\def\PYZrb{]}
\makeatother


    % For linebreaks inside Verbatim environment from package fancyvrb. 
    \makeatletter
        \newbox\Wrappedcontinuationbox 
        \newbox\Wrappedvisiblespacebox 
        \newcommand*\Wrappedvisiblespace {\textcolor{red}{\textvisiblespace}} 
        \newcommand*\Wrappedcontinuationsymbol {\textcolor{red}{\llap{\tiny$\m@th\hookrightarrow$}}} 
        \newcommand*\Wrappedcontinuationindent {3ex } 
        \newcommand*\Wrappedafterbreak {\kern\Wrappedcontinuationindent\copy\Wrappedcontinuationbox} 
        % Take advantage of the already applied Pygments mark-up to insert 
        % potential linebreaks for TeX processing. 
        %        {, <, #, %, $, ' and ": go to next line. 
        %        _, }, ^, &, >, - and ~: stay at end of broken line. 
        % Use of \textquotesingle for straight quote. 
        \newcommand*\Wrappedbreaksatspecials {% 
            \def\PYGZus{\discretionary{\char`\_}{\Wrappedafterbreak}{\char`\_}}% 
            \def\PYGZob{\discretionary{}{\Wrappedafterbreak\char`\{}{\char`\{}}% 
            \def\PYGZcb{\discretionary{\char`\}}{\Wrappedafterbreak}{\char`\}}}% 
            \def\PYGZca{\discretionary{\char`\^}{\Wrappedafterbreak}{\char`\^}}% 
            \def\PYGZam{\discretionary{\char`\&}{\Wrappedafterbreak}{\char`\&}}% 
            \def\PYGZlt{\discretionary{}{\Wrappedafterbreak\char`\<}{\char`\<}}% 
            \def\PYGZgt{\discretionary{\char`\>}{\Wrappedafterbreak}{\char`\>}}% 
            \def\PYGZsh{\discretionary{}{\Wrappedafterbreak\char`\#}{\char`\#}}% 
            \def\PYGZpc{\discretionary{}{\Wrappedafterbreak\char`\%}{\char`\%}}% 
            \def\PYGZdl{\discretionary{}{\Wrappedafterbreak\char`\$}{\char`\$}}% 
            \def\PYGZhy{\discretionary{\char`\-}{\Wrappedafterbreak}{\char`\-}}% 
            \def\PYGZsq{\discretionary{}{\Wrappedafterbreak\textquotesingle}{\textquotesingle}}% 
            \def\PYGZdq{\discretionary{}{\Wrappedafterbreak\char`\"}{\char`\"}}% 
            \def\PYGZti{\discretionary{\char`\~}{\Wrappedafterbreak}{\char`\~}}% 
        } 
        % Some characters . , ; ? ! / are not pygmentized. 
        % This macro makes them "active" and they will insert potential linebreaks 
        \newcommand*\Wrappedbreaksatpunct {% 
            \lccode`\~`\.\lowercase{\def~}{\discretionary{\hbox{\char`\.}}{\Wrappedafterbreak}{\hbox{\char`\.}}}% 
            \lccode`\~`\,\lowercase{\def~}{\discretionary{\hbox{\char`\,}}{\Wrappedafterbreak}{\hbox{\char`\,}}}% 
            \lccode`\~`\;\lowercase{\def~}{\discretionary{\hbox{\char`\;}}{\Wrappedafterbreak}{\hbox{\char`\;}}}% 
            \lccode`\~`\:\lowercase{\def~}{\discretionary{\hbox{\char`\:}}{\Wrappedafterbreak}{\hbox{\char`\:}}}% 
            \lccode`\~`\?\lowercase{\def~}{\discretionary{\hbox{\char`\?}}{\Wrappedafterbreak}{\hbox{\char`\?}}}% 
            \lccode`\~`\!\lowercase{\def~}{\discretionary{\hbox{\char`\!}}{\Wrappedafterbreak}{\hbox{\char`\!}}}% 
            \lccode`\~`\/\lowercase{\def~}{\discretionary{\hbox{\char`\/}}{\Wrappedafterbreak}{\hbox{\char`\/}}}% 
            \catcode`\.\active
            \catcode`\,\active 
            \catcode`\;\active
            \catcode`\:\active
            \catcode`\?\active
            \catcode`\!\active
            \catcode`\/\active 
            \lccode`\~`\~ 	
        }
    \makeatother

    \let\OriginalVerbatim=\Verbatim
    \makeatletter
    \renewcommand{\Verbatim}[1][1]{%
        %\parskip\z@skip
        \sbox\Wrappedcontinuationbox {\Wrappedcontinuationsymbol}%
        \sbox\Wrappedvisiblespacebox {\FV@SetupFont\Wrappedvisiblespace}%
        \def\FancyVerbFormatLine ##1{\hsize\linewidth
            \vtop{\raggedright\hyphenpenalty\z@\exhyphenpenalty\z@
                \doublehyphendemerits\z@\finalhyphendemerits\z@
                \strut ##1\strut}%
        }%
        % If the linebreak is at a space, the latter will be displayed as visible
        % space at end of first line, and a continuation symbol starts next line.
        % Stretch/shrink are however usually zero for typewriter font.
        \def\FV@Space {%
            \nobreak\hskip\z@ plus\fontdimen3\font minus\fontdimen4\font
            \discretionary{\copy\Wrappedvisiblespacebox}{\Wrappedafterbreak}
            {\kern\fontdimen2\font}%
        }%
        
        % Allow breaks at special characters using \PYG... macros.
        \Wrappedbreaksatspecials
        % Breaks at punctuation characters . , ; ? ! and / need catcode=\active 	
        \OriginalVerbatim[#1,codes*=\Wrappedbreaksatpunct]%
    }
    \makeatother

    % Exact colors from NB
    \definecolor{incolor}{HTML}{303F9F}
    \definecolor{outcolor}{HTML}{D84315}
    \definecolor{cellborder}{HTML}{CFCFCF}
    \definecolor{cellbackground}{HTML}{F7F7F7}
    
    % prompt
    \makeatletter
    \newcommand{\boxspacing}{\kern\kvtcb@left@rule\kern\kvtcb@boxsep}
    \makeatother
    \newcommand{\prompt}[4]{
        {\ttfamily\llap{{\color{#2}[#3]:\hspace{3pt}#4}}\vspace{-\baselineskip}}
    }
    

    
    % Prevent overflowing lines due to hard-to-break entities
    \sloppy 
    % Setup hyperref package
    \hypersetup{
      breaklinks=true,  % so long urls are correctly broken across lines
      colorlinks=true,
      urlcolor=urlcolor,
      linkcolor=linkcolor,
      citecolor=citecolor,
      }
    % Slightly bigger margins than the latex defaults
    
    \geometry{verbose,tmargin=1in,bmargin=1in,lmargin=1in,rmargin=1in}
    
    

\begin{document}
    
    \maketitle
    
    

    
    \hypertarget{signal-processing-and-machine-learning-for-finance-coursework}{%
\section{Signal Processing and Machine Learning for Finance
Coursework}\label{signal-processing-and-machine-learning-for-finance-coursework}}

    \hypertarget{regression-methods}{%
\subsection{1 Regression Methods}\label{regression-methods}}

    \hypertarget{processing-stock-price-data-in-python}{%
\subsubsection{1.1 Processing stock price data in
Python}\label{processing-stock-price-data-in-python}}

    \hypertarget{import}{%
\paragraph{1.1.1 Import}\label{import}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{2}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
\PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}
\PY{k+kn}{from} \PY{n+nn}{scipy} \PY{k+kn}{import} \PY{n}{stats}
\PY{k+kn}{from} \PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{stats} \PY{k+kn}{import} \PY{n}{pearsonr}
\PY{k+kn}{from} \PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{stats} \PY{k+kn}{import} \PY{n}{norm}
\PY{k+kn}{import} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{pyplot} \PY{k}{as} \PY{n+nn}{plt}
\PY{k+kn}{from} \PY{n+nn}{matplotlib}\PY{n+nn}{.}\PY{n+nn}{ticker} \PY{k+kn}{import} \PY{n}{PercentFormatter}
\PY{k+kn}{from} \PY{n+nn}{statsmodels}\PY{n+nn}{.}\PY{n+nn}{tsa}\PY{n+nn}{.}\PY{n+nn}{arima\PYZus{}model} \PY{k+kn}{import} \PY{n}{ARIMA} 
\PY{k+kn}{from} \PY{n+nn}{statsmodels}\PY{n+nn}{.}\PY{n+nn}{tsa}\PY{n+nn}{.}\PY{n+nn}{ar\PYZus{}model} \PY{k+kn}{import} \PY{n}{AR} 
\PY{k+kn}{from} \PY{n+nn}{statsmodels}\PY{n+nn}{.}\PY{n+nn}{robust}\PY{n+nn}{.}\PY{n+nn}{scale} \PY{k+kn}{import} \PY{n}{mad}
\PY{k+kn}{import} \PY{n+nn}{copy}
\PY{k+kn}{import} \PY{n+nn}{warnings}
\PY{k+kn}{from} \PY{n+nn}{sklearn} \PY{k+kn}{import} \PY{n}{linear\PYZus{}model}
\PY{k+kn}{from} \PY{n+nn}{sklearn}\PY{n+nn}{.}\PY{n+nn}{metrics} \PY{k+kn}{import} \PY{n}{mean\PYZus{}squared\PYZus{}error}
\PY{k+kn}{import} \PY{n+nn}{seaborn} \PY{k}{as} \PY{n+nn}{sn}
\PY{k+kn}{from} \PY{n+nn}{statsmodels}\PY{n+nn}{.}\PY{n+nn}{tsa}\PY{n+nn}{.}\PY{n+nn}{api} \PY{k+kn}{import} \PY{n}{VAR}
\PY{n}{warnings}\PY{o}{.}\PY{n}{filterwarnings}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ignore}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{o}{\PYZpc{}}\PY{k}{matplotlib} inline
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{3}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{px} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{priceData.csv}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{index\PYZus{}col}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{date}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{c+c1}{\PYZsh{}dropping nan values}
\PY{n}{px} \PY{o}{=} \PY{n}{px}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{4}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{print}\PY{p}{(}\PY{n}{px}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{n+nb}{type}\PY{p}{(}\PY{n}{px}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
            SPX Index
date
02/01/1930      21.18
03/01/1930      21.23
06/01/1930      21.50
07/01/1930      21.31
08/01/1930      21.29
{\ldots}               {\ldots}
15/06/2017    2432.46
16/06/2017    2433.15
19/06/2017    2453.46
20/06/2017    2437.03
21/06/2017    2434.36

[21974 rows x 1 columns]
<class 'pandas.core.frame.DataFrame'>
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{6}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} transform dataframe to series (important for plotting)}
\PY{n}{px} \PY{o}{=} \PY{n}{px}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{SPX Index}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}
\PY{c+c1}{\PYZsh{} only transform the index to log}
\PY{n}{logpx} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{px}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{7}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{logpx}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Natural Log transform of SPI Index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dates}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Log Value Index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{px}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{SPI Index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dates}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Value Index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_8_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{sliding-window}{%
\paragraph{1.1.2 Sliding Window}\label{sliding-window}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{8}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} sliding mean}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Sliding Mean of 252 days}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dates}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Log Value of Index Mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{logpx}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{252}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} sliding standard deviation}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Sliding Variance of 252 days}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dates}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Log Value of Index Variance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{logpx}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{252}\PY{p}{)}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_10_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{log-return-simple-return}{%
\paragraph{1.1.3 Log Return \& Simple
Return}\label{log-return-simple-return}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{86}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} log return, diff(): out[i] = arr[i+1] – arr[i]}
\PY{n}{logret} \PY{o}{=} \PY{n}{logpx}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{p}{)}
\PY{c+c1}{\PYZsh{} simple return, pct\PYZus{}change(): Percentage change between the current and a prior element.}
\PY{n}{simpret} \PY{o}{=} \PY{n}{px}\PY{o}{.}\PY{n}{pct\PYZus{}change}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{87}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} sliding mean}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{10}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Logret Mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{logret}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{252}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{deepskyblue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Simpret Mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{simpret}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{252}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{royalblue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{3}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Logret Variance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{logret}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{252}\PY{p}{)}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{deepskyblue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Simpret Variance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{simpret}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{252}\PY{p}{)}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{royalblue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_13_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    The graphs we see for the sliding windows of the logret and simpret are
much more stationary than the first plot we did in 1.1.1 . Therefore we
can conclude that the log and simple price return time series is of
order one.

    \hypertarget{section}{%
\paragraph{1.1.4}\label{section}}

    Returns are defined as: \[r[t] = \frac{p[t]}{p[t-1]}-1\] Log-Returns are
defined as: \[r[t] = ln(p[t])-ln(p[t-1]) =\log\frac{p[t]}{p[t-1]}\]

As seen in Lecture 2: Log-normality of prices: Over short periods of
time, prices tend to be distributed log-normally (1). As a result:
\[p[t] \sim \text{log-normal} \]
\[\frac{p[t]}{p[t-1]} \sim \text{log-normal}\]
\[r[t] = \log[\frac{p[t]}{p[t-1]}] \sim \text{normal}\] r{[}t{]} is
hence considered to be conveniently normally distributed which is handy
since many SP techniques assume normality.

Log return is concentrated around zero, which is convenient. In
addition, log compresses the range of data and also conditions the
original data. One great effeckt is that we can simply multiply and
divide by log values and come back to the original value as compared to
non log multiplication followed by division. E.g. for log returns, a 15
\% increase in price followed by 15 \% decrease results in the initial
price, thus reflecting the symmetric behaviour of log returns.

    With the help of statsmodels.jarque\_bera() method, we can get the
jarque bera test for normality and it's a test based on skewness, and
the kurtosis, and has an asymptotic distribution.
https://www.statology.org/jarque-bera-test-python/

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{88}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} return the Jarque−Bera test p−value for a log time−series x }
\PY{n}{stats}\PY{o}{.}\PY{n}{jarque\PYZus{}bera}\PY{p}{(}\PY{n}{logret}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{l+m+mi}{21974}\PY{p}{]}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{88}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
0.0
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{89}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} return the Jarque−Bera test p−value for a time−series x }
\PY{n}{stats}\PY{o}{.}\PY{n}{jarque\PYZus{}bera}\PY{p}{(}\PY{n}{px}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{l+m+mi}{21974}\PY{p}{]}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{89}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
0.0
\end{Verbatim}
\end{tcolorbox}
        
    Since the value is bellow 0.5, we reject the null hypothesis. Thus, we
have sufficient evidence to say that this data has skewness and kurtosis
that is significantly different from a normal distribution. This does
not correspond to our thoughts above about the log return having a
normal distribution. If we look at the data we can make the educated
guess that this is because of the long timeframe of the data and the big
amounts of datapoints.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{90}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{stats}\PY{o}{.}\PY{n}{jarque\PYZus{}bera}\PY{p}{(}\PY{n}{logret}\PY{p}{[}\PY{l+m+mi}{920}\PY{p}{:}\PY{l+m+mi}{1000}\PY{p}{]}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{90}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
0.5171888035876846
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{91}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} return the Jarque−Bera test p−value for a time−series x }
\PY{n}{stats}\PY{o}{.}\PY{n}{jarque\PYZus{}bera}\PY{p}{(}\PY{n}{px}\PY{p}{[}\PY{l+m+mi}{920}\PY{p}{:}\PY{l+m+mi}{1000}\PY{p}{]}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{91}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
0.26669014418605297
\end{Verbatim}
\end{tcolorbox}
        
    We see that we get a value over 0.5 and thus don't reject the null
hypothesis and have sufficient evidence to say that this distribution
has skewness and kurtosis of a normal distribution. We also see a
difference between the log transformed data and the plain data. We see
that the log data are distributed much more like a normal distribution
as the plain data.

    \hypertarget{stock-purchase}{%
\paragraph{1.1.5 Stock purchase}\label{stock-purchase}}

    We can write ouut the entire calculation and see that the advantage of
the log, we see that we come back to the same price.

\[r[1] = \log[\frac{p[t+1]}{p[t]}] = \log[\frac{2}{1}] = 0.69 \]
\[r[2] = \log[\frac{p[t+2]}{p[t+1]}] = \log[\frac{1}{2}] = -0.69 \]

Where t is the starting time were the stock was 1£.

So if we have have a positive log return in the first day of 0.69 and
the next day the stock falls down to it's original value and we get the
negative log return of -0.69 these two values just cancel each other out
and we're at the point where we started.

    \hypertarget{when-not-to-use-log-returns}{%
\paragraph{1.1.6 When not to use log
returns}\label{when-not-to-use-log-returns}}

    \begin{itemize}
\item
  As already seen in 1.1.4 the assumption of log-normality over long
  time-scales is unrealistic. A positive skew is assumed in log-normal
  distributions, but most financial data is negatively skewed in long
  time-scales, owing to financial crashes
\item
  Logarithmic returns are not linearly additive across assets (whereas
  simple returns are linearly additive)
\end{itemize}

    \hypertarget{arma-vs.-arima-models-for-financial-applications}{%
\subsection{1.2 ARMA vs.~ARIMA Models for Financial
Applications}\label{arma-vs.-arima-models-for-financial-applications}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{92}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{snp} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{snp\PYZus{}500\PYZus{}2015\PYZus{}2019.csv}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{snp}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Date}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{snp\PYZus{}close} \PY{o}{=} \PY{n}{snp}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{to\PYZus{}frame}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{93}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{snp\PYZus{}close\PYZus{}ts} \PY{o}{=} \PY{n}{snp\PYZus{}close}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{c+c1}{\PYZsh{} transformation from dataframe to series}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{arma-or-arima}{%
\subsubsection{1.2.1 Arma or Arima?}\label{arma-or-arima}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{94}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
\PY{n}{snp\PYZus{}close\PYZus{}ts}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Natural Log transform of SPI Index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dates}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Log Value Index}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{94}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
Text(0, 0.5, 'Log Value Index')
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_32_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    ARMA models should be used when the data is stationary In case the data
shows elements of non-stationarity, a generalization of ARMA is used,
i.e. the autoregressive integrated moving average (ARIMA). We can see if
the data is non stationary by looking at the sliding window mean and
variance as seen above.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{95}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} sliding mean}
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Sliding Mean of 252 days}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dates}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Log Value of Index Mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{snp\PYZus{}close\PYZus{}ts}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{252}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} sliding standard deviation}
\PY{n}{plt}\PY{o}{.}\PY{n}{subplot}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Sliding Variance of 252 days}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dates}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Log Value of Index Variance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{snp\PYZus{}close\PYZus{}ts}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{252}\PY{p}{)}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_34_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    We see the mean is not stationary and we therefore better use an ARIMA
model.

    \hypertarget{fit-arma-model}{%
\subsubsection{1.2.2 Fit Arma model}\label{fit-arma-model}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{96}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{snp\PYZus{}arma} \PY{o}{=} \PY{n}{copy}\PY{o}{.}\PY{n}{deepcopy}\PY{p}{(}\PY{n}{snp\PYZus{}close}\PY{p}{)}
\PY{n}{snp\PYZus{}arma}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{modelarma} \PY{o}{=} \PY{n}{ARIMA}\PY{p}{(}\PY{n}{snp\PYZus{}arma} \PY{p}{,}\PY{n}{order} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{p}{)}
\PY{n}{snp\PYZus{}arma}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Res}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{modelarma}\PY{o}{.}\PY{n}{resid}
\PY{n}{snp\PYZus{}arma\PYZus{}rmse} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{snp\PYZus{}arma}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Res}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}
\PY{n}{snp\PYZus{}arma}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Prediction}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{snp\PYZus{}arma}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{snp\PYZus{}arma}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Res}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
RUNNING THE L-BFGS-B CODE

           * * *

Machine precision = 2.220D-16
 N =            2     M =           12

At X0         0 variables are exactly at the bounds

At iterate    0    f= -3.33214D+00    |proj g|=  1.36670D-02

At iterate    5    f= -3.33271D+00    |proj g|=  2.09610D-05

           * * *

Tit   = total number of iterations
Tnf   = total number of function evaluations
Tnint = total number of segments explored during Cauchy searches
Skip  = number of BFGS updates skipped
Nact  = number of active bounds at final generalized Cauchy point
Projg = norm of the final projected gradient
F     = final function value

           * * *

   N    Tit     Tnf  Tnint  Skip  Nact     Projg        F
    2      9     12      1     0     0   0.000D+00  -3.333D+00
  F =  -3.3327062307749138

CONVERGENCE: NORM\_OF\_PROJECTED\_GRADIENT\_<=\_PGTOL
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
 This problem is unconstrained.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{97}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Arma(1,0)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dates}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Log Value of Index Mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{snp\PYZus{}arma}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
\PY{n}{snp\PYZus{}arma}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Prediction}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Prediction}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_38_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{98}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{modelarma}\PY{o}{.}\PY{n}{params}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{98}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
const         7.739997
ar.L1.True    0.997359
dtype: float64
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{99}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{snp\PYZus{}arma} \PY{o}{=} \PY{n}{copy}\PY{o}{.}\PY{n}{deepcopy}\PY{p}{(}\PY{n}{snp\PYZus{}close}\PY{p}{)}
\PY{n}{snp\PYZus{}arma}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{modelarma5} \PY{o}{=} \PY{n}{ARIMA}\PY{p}{(}\PY{n}{snp\PYZus{}arma} \PY{p}{,}\PY{n}{order} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{4}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
RUNNING THE L-BFGS-B CODE

           * * *

Machine precision = 2.220D-16
 N =            5     M =           12

At X0         0 variables are exactly at the bounds

At iterate    0    f= -3.33332D+00    |proj g|=  1.59244D-02

At iterate    5    f= -3.33406D+00    |proj g|=  3.01670D-04

At iterate   10    f= -3.33407D+00    |proj g|=  2.22045D-06

           * * *

Tit   = total number of iterations
Tnf   = total number of function evaluations
Tnint = total number of segments explored during Cauchy searches
Skip  = number of BFGS updates skipped
Nact  = number of active bounds at final generalized Cauchy point
Projg = norm of the final projected gradient
F     = final function value

           * * *

   N    Tit     Tnf  Tnint  Skip  Nact     Projg        F
    5     13     18      1     0     0   8.882D-08  -3.334D+00
  F =  -3.3340652406598812

CONVERGENCE: REL\_REDUCTION\_OF\_F\_<=\_FACTR*EPSMCH
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
 This problem is unconstrained.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{100}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{modelarma5}\PY{o}{.}\PY{n}{params}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{100}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
const         7.739234
ar.L1.True    0.990555
ar.L2.True   -0.043167
ar.L3.True    0.062720
ar.L4.True   -0.012640
dtype: float64
\end{Verbatim}
\end{tcolorbox}
        
    We see that the L1 coefficient is really near to 1 and therefore the
next few coefficients would just be really small. Therefore also the
optimal model order is 1. In practice we want to be able to predict the
price of the index for future values, since the L1 just takes into
consideration the last seen value, it is very bad at predicting the
future value of the index, so there's no practical value in this model.

    \hypertarget{arima-110}{%
\subsubsection{1.2.3 Arima (1,1,0)}\label{arima-110}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{101}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{snp\PYZus{}arima} \PY{o}{=} \PY{n}{copy}\PY{o}{.}\PY{n}{deepcopy}\PY{p}{(}\PY{n}{snp\PYZus{}close}\PY{p}{)}
\PY{n}{snp\PYZus{}arima}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{modelarima} \PY{o}{=} \PY{n}{ARIMA}\PY{p}{(}\PY{n}{snp\PYZus{}arima} \PY{p}{,}\PY{n}{order} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{p}{)}
\PY{n}{snp\PYZus{}arima}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Res}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{modelarima}\PY{o}{.}\PY{n}{resid}
\PY{n}{snp\PYZus{}arima}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Prediction}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{snp\PYZus{}arima}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{snp\PYZus{}arima}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Res}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
RUNNING THE L-BFGS-B CODE

           * * *

Machine precision = 2.220D-16
 N =            2     M =           12

At X0         0 variables are exactly at the bounds

At iterate    0    f= -3.33487D+00    |proj g|=  2.49955D-01

At iterate    5    f= -3.33488D+00    |proj g|=  2.26485D-06

           * * *

Tit   = total number of iterations
Tnf   = total number of function evaluations
Tnint = total number of segments explored during Cauchy searches
Skip  = number of BFGS updates skipped
Nact  = number of active bounds at final generalized Cauchy point
Projg = norm of the final projected gradient
F     = final function value

           * * *

   N    Tit     Tnf  Tnint  Skip  Nact     Projg        F
    2      6     16      1     0     0   8.882D-08  -3.335D+00
  F =  -3.3348750935177054

CONVERGENCE: REL\_REDUCTION\_OF\_F\_<=\_FACTR*EPSMCH
    \end{Verbatim}

    \begin{Verbatim}[commandchars=\\\{\}]
 This problem is unconstrained.
    \end{Verbatim}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{102}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Arima(1,1,0)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dates}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Log Value of Index Mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{snp\PYZus{}arima}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
\PY{n}{snp\PYZus{}arima}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Prediction}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{True}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Prediction}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_45_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    We can again look at the RMSE by looking at the residues

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{103}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{snp\PYZus{}arima\PYZus{}rmse} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{snp\PYZus{}arima}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Res}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Arma RMSE: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{n}{snp\PYZus{}arma\PYZus{}rmse}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Arima RMSE: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{snp\PYZus{}arima\PYZus{}rmse}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Difference: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{snp\PYZus{}arma\PYZus{}rmse}\PY{o}{\PYZhy{}}\PY{n}{snp\PYZus{}arima\PYZus{}rmse}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Arma RMSE:  0.009288260126805767 Arima RMSE:  0.008618764909411391
Difference:  0.0006694952173943759
    \end{Verbatim}

    Both models fit the data pretty good. We see that the Arima(1,1,0) does
a slightly better approximation. Now if we try different arima models
with different degrees, we can get some more insights.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{113}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{snp\PYZus{}arima\PYZus{}rmse\PYZus{}dict} \PY{o}{=} \PY{p}{\PYZob{}}\PY{p}{\PYZcb{}}
\PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range} \PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{20}\PY{p}{)}\PY{p}{:}
    \PY{n}{snp\PYZus{}arima} \PY{o}{=} \PY{n}{copy}\PY{o}{.}\PY{n}{deepcopy}\PY{p}{(}\PY{n}{snp\PYZus{}close}\PY{p}{)}
    \PY{n}{snp\PYZus{}arima}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
    \PY{n}{modelarima} \PY{o}{=} \PY{n}{ARIMA}\PY{p}{(}\PY{n}{snp\PYZus{}arima} \PY{p}{,}\PY{n}{order} \PY{o}{=} \PY{p}{(}\PY{n}{i}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{0}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{disp}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
    \PY{n}{snp\PYZus{}arima}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Res}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{modelarima}\PY{o}{.}\PY{n}{resid}
    \PY{n}{snp\PYZus{}arima\PYZus{}rmse} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sqrt}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{snp\PYZus{}arima}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Res}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{*}\PY{o}{*}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{)}
    \PY{n}{snp\PYZus{}arima}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Prediction}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{snp\PYZus{}arima}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{True}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{snp\PYZus{}arima}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Res}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
    \PY{n}{snp\PYZus{}arima\PYZus{}rmse\PYZus{}dict}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n}{snp\PYZus{}arima\PYZus{}rmse}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{114}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{snp\PYZus{}arima\PYZus{}rmse\PYZus{}dict}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{114}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\{0: 0.008619092241596888,
 1: 0.008618764909411391,
 2: 0.008607195181514937,
 3: 0.008606681441828943,
 4: 0.008587341369335724,
 5: 0.008586955708982822,
 6: 0.008585706715522372,
 7: 0.008584177169524882,
 8: 0.00856277616767019,
 9: 0.00856043096415993,
 10: 0.008559742429132981,
 11: 0.00855797107484998,
 12: 0.008557845678735168,
 13: 0.008557543949305598,
 14: 0.008528452449345155,
 15: 0.008516113090304991,
 16: 0.008513364416898626,
 17: 0.00850202143680456,
 18: 0.008493808007187513,
 19: 0.00848628035589335\}
\end{Verbatim}
\end{tcolorbox}
        
    We see the error becomes smaller and smaller and we still get a
significant difference between results since they are of order
\(\geq 10^{-4}\) . Therefore these models of higher order could have a
physical meaning and be practical in reality since they don't just look
at the datapoint before but more complex correlations. So Arima(1,1,0)
is more physically meaningful if we go to higher orders than Arma(1,0).

    \hypertarget{why-do-we-take-log-of-prices}{%
\subsubsection{1.2.4 Why do we take log of
prices?}\label{why-do-we-take-log-of-prices}}

    If we take the arima model, we introduce a differentiation term, which
as seen in the lecture can be approximated by a difference of two
subsequent terms. If we now take the log of these terms, we see that the
difference of those will give us back the log return. As already
mentioned, stock prices over a short period tend to be log-normally
distributed what then makes the log returns behave stationary.

    \hypertarget{vector-autoregressive-var-models}{%
\subsection{1.3 Vector Autoregressive (VAR)
Models}\label{vector-autoregressive-var-models}}

    \hypertarget{section}{%
\subsubsection{1.3.1}\label{section}}

    We can set the matrices as seen in the lecture slides as:

\begin{equation}
    \textbf{Y} = 
    \begin{pmatrix}
        y_{1,T-1} & y_{1,T-2} & \cdots & y_{1,0} \\
        y_{2,T-1} & y_{2,T-2} & \cdots & y_{2,0} \\
        \vdots        &       \vdots  & \ddots &       \vdots \\
        y_{K,T-1} & y_{K,T-2} & \cdots & y_{K,0} \\ 
    \end{pmatrix} \in R^{K \times T}
\end{equation}

\begin{equation}
    \textbf{A_i} =
        \begin{pmatrix}
        c_{1}      &      a_{1,1}^{i} & a_{1,2}^{i} & \cdots & a_{1,K}^{i}\\
        c_{2}      &      a_{2,1}^{i} & a_{2,2}^{i} & \cdots & a_{2,K}^{i}\\
        \vdots     &      \vdots      & \vdots      & \ddots & \vdots     \\
        c_{K}      &      a_{K,1}^{i} & a_{K,2}^{i} & \cdots & a_{K,K}^{i}\\ 
    \end{pmatrix} \in R^{K \times K}
\end{equation}

\begin{equation}
    \textbf{B} = 
    \begin{pmatrix}
        \textbf{A_1} & \textbf{A_2} & \cdots & \textbf{A_P}
    \end{pmatrix} \in R^{K \times (KP + 1)}
\end{equation}

\begin{equation}
    \textbf{Z} = 
    \begin{pmatrix}
            1             &        1      & \cdots &     1     \\
        y_{1,t-1}^{1} & y_{1,t-2}^{1} & \cdots & y_{1,t-p}^{1} \\
        y_{2,t-1}^{1} & y_{2,t-2}^{1} & \cdots & y_{2,t-p}^{1} \\
        \vdots        &       \vdots  & \ddots &       \vdots \\
        y_{K,t-1}^{1} & y_{K,t-2}^{1} & \cdots & y_{K,t-p}^{1} \\
        y_{1,t-1}^{2} & y_{1,t-2}^{2} & \cdots & y_{1,t-p}^{2} \\
        \vdots        &       \vdots  & \ddots &       \vdots \\
        y_{K,t-1}^{p} & y_{K,t-2}^{p} & \cdots & y_{K,t-p}^{p} \\ 
    \end{pmatrix} \in R^{(KP + 1) \times T}
\end{equation}

\begin{equation}
    \textbf{U} = 
    \begin{pmatrix}
        e_{1,T-1} & e_{1,T-2} & \cdots & e_{1,0} \\
        e_{2,T-1} & e_{2,T-2} & \cdots & e_{2,0} \\
        \vdots    &   \vdots  & \ddots &   \vdots \\
        e_{K,T-1} & e_{K,T-2} & \cdots & e_{K,0} \\ 
    \end{pmatrix} \in R^{K \times T}
\end{equation}

With that we can get the wanted concise form.

    \hypertarget{section}{%
\subsubsection{1.3.2}\label{section}}

    We can derive this expression by a least squares estimation of
\(\mathbf{B}\). Since \(\mathbf{B}_{opt}\) is the optimal value for
\(\mathbf{B}\) the error term \(\mathbf{U}\) has therefore to be
minimized in a least squares fasion.

Our aim therefore is to minimize: \[\mathbf{U}^{T}\mathbf{U}\]

At first we need to rearange our equation to get
\(\mathbf{U} = \mathbf{Y} - \mathbf{B}\mathbf{Z}\) and therefore:
\[\mathbf{U}^{T}\mathbf{U} = (\mathbf{Y} - \mathbf{B}\mathbf{Z})^{T}(\mathbf{Y}- \mathbf{B}\mathbf{Z})\]

    Now we have to differentiate \(\mathbf{U}^{T}\mathbf{U}\) by
\(\partial\mathbf{B}\) to get the minimum.

\[\frac{\partial \mathbf{U}^{T} \mathbf{U}}{\partial \mathbf{B}} =  \frac{\partial \mathbf{U}^{T}\mathbf{U}}{\partial \mathbf{U}^{T}} \frac{\mathbf{U}^{T}}{\partial \mathbf{B}}\]

    \begin{figure}
\centering
\includegraphics{attachment:photo_2022-02-24_15-55-03.jpg}
\caption{photo\_2022-02-24\_15-55-03.jpg}
\end{figure}

    \hypertarget{section}{%
\subsubsection{1.3.3}\label{section}}

    If we use equation 6 and insert it into 7 we see that we an inductively
continue this to infinity. Therefore the effects of the eigenvalues of A
have to be considered. Since we know that for a stable system the
eigenvalues have to be less than 1 in absolute value for the system to
be stable according to the Ralph-Hurwitz Criterion. To give a better
idea one can imagine that we have a function with an exponent higher
than the absolute value of 1 that describes a system, if we let this
system run to infinity the terms will add up more and more and the
system will be unstable, since the exponential terms won't die down.

    \begin{figure}
\centering
\includegraphics{attachment:IMG_2477.jpg}
\caption{IMG\_2477.jpg}
\end{figure}

    \hypertarget{section}{%
\subsubsection{1.3.4}\label{section}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{107}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{snp\PYZus{}allstocks\PYZus{}2015\PYZus{}2019.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} 
\PY{n}{df} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Date}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{info} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{snp\PYZus{}info.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} 
\PY{n}{info}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{n}{info}\PY{o}{.}\PY{n}{columns}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{108}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{tickers} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{CAG}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{MAR}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{LIN}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{HCP}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{MAT}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{stocks} \PY{o}{=} \PY{n}{df}\PY{p}{[}\PY{n}{tickers}\PY{p}{]}
\PY{n}{stocks\PYZus{}ma} \PY{o}{=} \PY{n}{stocks}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{n}{window}\PY{o}{=}\PY{l+m+mi}{66}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
\PY{n}{stocks\PYZus{}detrended} \PY{o}{=} \PY{n}{stocks}\PY{o}{.}\PY{n}{sub}\PY{p}{(}\PY{n}{stocks\PYZus{}ma}\PY{p}{)}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{109}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{model} \PY{o}{=} \PY{n}{VAR}\PY{p}{(}\PY{n}{stocks\PYZus{}detrended}\PY{p}{)}
\PY{n}{results} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{A} \PY{o}{=} \PY{n}{results}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{values}
\PY{n}{eigA}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{eig}\PY{p}{(}\PY{n}{A}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{110}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n+nb}{abs}\PY{p}{(}\PY{n}{eigA}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{110}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
array([0.72609393, 0.72609393, 1.00635964, 0.86051894, 0.91144512])
\end{Verbatim}
\end{tcolorbox}
        
    Note that one of the eigenvalues has an absolute value of more than 1.
Therefore this model is not stable and it's not a good idea to take up
those stocks in the portfolio. We can also look at how correlated this
values are, since we would prefer the values to be highly uncorrelated
in a portfolio, since we want ot have the best diversification and
therefore lowest risk.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{111}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{stocks\PYZus{}detrended}\PY{o}{.}\PY{n}{corr}\PY{p}{(}\PY{p}{)}
\PY{n}{sn}\PY{o}{.}\PY{n}{heatmap}\PY{p}{(}\PY{n}{stocks\PYZus{}detrended}\PY{o}{.}\PY{n}{corr}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{annot}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_70_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Looking at this correlation matrix, we see that some stocks are highly
corrrelated and we should therefore not construct a portfolio with those
values.

    \hypertarget{section}{%
\subsubsection{1.3.5}\label{section}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{112}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{for} \PY{n}{sector} \PY{o+ow}{in} \PY{n}{info}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{GICS Sector}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{unique}\PY{p}{(}\PY{p}{)}\PY{p}{:}
    \PY{n}{tickers} \PY{o}{=} \PY{n}{info}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{info}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{GICS Sector}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{n}{sector}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Symbol}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{tolist}\PY{p}{(}\PY{p}{)}
    \PY{n}{stocks}\PY{o}{=}\PY{n}{df}\PY{p}{[}\PY{n}{tickers}\PY{p}{]}
    \PY{n}{stocks\PYZus{}ma} \PY{o}{=} \PY{n}{stocks}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{n}{window}\PY{o}{=}\PY{l+m+mi}{66}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
    \PY{n}{stocks\PYZus{}detrended} \PY{o}{=} \PY{n}{stocks}\PY{o}{.}\PY{n}{sub}\PY{p}{(}\PY{n}{stocks\PYZus{}ma}\PY{p}{)}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}
    \PY{n}{model} \PY{o}{=} \PY{n}{VAR}\PY{p}{(}\PY{n}{stocks\PYZus{}detrended}\PY{p}{)}
    \PY{n}{results} \PY{o}{=} \PY{n}{model}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}
    \PY{n}{A} \PY{o}{=} \PY{n}{results}\PY{o}{.}\PY{n}{params}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{values}
    \PY{n}{eigA}\PY{p}{,} \PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{eig}\PY{p}{(}\PY{n}{A}\PY{p}{)}
    \PY{k}{if} \PY{p}{(}\PY{n+nb}{max}\PY{p}{(}\PY{n+nb}{abs}\PY{p}{(}\PY{n}{eigA}\PY{p}{)}\PY{o}{\PYZlt{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{:}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model is stable: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{sector}\PY{p}{)}
    \PY{k}{else}\PY{p}{:}
        \PY{n+nb}{print}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Model is not stable: }\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{sector}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
Model is stable:  Industrials
Model is stable:  Health Care
Model is stable:  Information Technology
Model is stable:  Communication Services
Model is stable:  Consumer Discretionary
Model is stable:  Utilities
Model is stable:  Financials
Model is stable:  Materials
Model is stable:  Real Estate
Model is stable:  Consumer Staples
Model is stable:  Energy
    \end{Verbatim}

    We see that all the models that are fitted just onto the stocks of a
certain sector show us a stable behavior. For portfolio construction
it's not advisable to only take stocks from the same sector since they
are highly positively correlated. Hence it is best if we take stocks
from all the different sectors and look especially for negative
correlations, since if the price of a stock A goes down and we have a
stock B that is negatively correlated to stock A, stock B will probably
behave contrarily and go up. Therefore we're pretty safe against losses,
since some lossy stocks can get equalized with negatively correlated
stocks to them. But one has to be careful, since the correlation between
stocks is not a fixed factor, therefore it changes over time. As an
example if there is a financial market crash like in 2007-2008 the
correlation of many stocks goes up and a lot of stocks get highly
correlated, since the entire market goes down.

    \hypertarget{bond-pricing}{%
\subsection{2 Bond Pricing}\label{bond-pricing}}

    \hypertarget{examples-of-bond-pricing}{%
\subsubsection{2.1 Examples of Bond
Pricing}\label{examples-of-bond-pricing}}

    \hypertarget{section}{%
\paragraph{2.1.1}\label{section}}

    An investor has the following amounts of money at each timestep in
years: year 0: USD1000, year 1: USD1100.

    \(V_{i}\) = initial value (USD1000), \(V_{1}\) = final value after 1
year (USD1100)

    Bellow are the different compounding periods. We use the formula
\[ V_1 = V_i \times (1+\frac{R}{n})^{n}\]

and if we let n go to infinity we get

\[ lim_{n->\infty} (1+\frac{R}{n})^{n} = e^{R} \]

    \begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Annual:
\end{enumerate}

\[ V_1= V_i \times (1+R) \]

\[ R={\frac {V_{1}-V_{i}}{V_{i}}} = 10\% \]

    \begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Semiannual:
\end{enumerate}

\[ V_1= V_i \times (1+\frac{R}{2})^2 \]
\[ R=(\sqrt{\frac{V_1}{V_i}}-1) \times 2 = 0.0976=9.76\%\]

    \begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  Monthly:
\end{enumerate}

\[ R = V_i \times (1+\frac{R}{12})^{12}\]
\[ R =[(\frac{V_1}{V_i})^{\frac{1}{12}}-1] \times 12 = 0.0956 = 9.56 \%  \]

    \begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Continuous:
\end{enumerate}

    \[ V_1 = V_i \times e^{R} \]
\[ R = \log_{e}(\frac{C_1}{V_i})=0.0953=9.53\% \]

    \hypertarget{section}{%
\paragraph{2.1.2}\label{section}}

    If we want to compare 15\% of continuous compounding to monthly
compounding on a per annum basis we have to set the two equations from
above to be equal:

\[ V_i \times (1+\frac{R_m}{12})^{12} = V_i \times e^{R} \]

    With \$ R\_m = 0.15 \$ the per annum monthly compounding return rate.

    We can then directly solve for R:
\[ R=\log_{e}((1+\frac{R_a}{12})^{12})=0.1491=14.91 \% \]

    \hypertarget{section}{%
\paragraph{2.1.3}\label{section}}

    Each time the interest is paid, we can add it to our account. We denote
the amoun of interest paid with \(I_i\) for \(i = \{1,2,3,4\}\) and
\(X\) = USD10000 as the starting amount.

    \begin{itemize}
\tightlist
\item
  Q1: \$ I\_1 = X \times (e\^{}\{0.12 * 0.25\} -1) = \$ USD304.55
\item
  Q2: \$ I\_2 = X + I\_1 \times (e\^{}\{0.12 * 0.25\} -1) = \$ USD313.82
\item
  Q3: \$ I\_3 = X + I\_1 + I\_2 \times (e\^{}\{0.12 * 0.25\} -1) = \$
  USD323.23
\item
  Q4: \$ I\_4 = X + I\_1 + I\_2 + I\_3 \times (e\^{}\{0.12 * 0.25\} -1)
  = \$ USD333.23
\end{itemize}

Total: USD 1274.83

    \hypertarget{forward-rates}{%
\subsubsection{2.2 Forward rates}\label{forward-rates}}

    \hypertarget{section}{%
\paragraph{2.2.1}\label{section}}

    \begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  It depends on the investor, if you don't want to spend this money to
  urgently, then you'll be happy with the 9\% but if you need the money,
  you could also not be happy with 9\%. The second year return rate is
  also higher than the second we want more return because we sacrifice
  the pleasure of spending the money for one more year.
\end{enumerate}

    \begin{enumerate}
\def\labelenumi{\alph{enumi})}
\setcounter{enumi}{1}
\tightlist
\item
  In the arbitrage-free environment, the rates for different durations
  won't give an investor any advantages in the sense of arbitrage
  opportunities, since they are based on current market expectations. An
  investor will gain flexibility with going with a shorter duration of
  investment. Also in the real world, the risk of a default of the bank
  is not zero and therefore it is riskier to let your money with a
  certain bank for a longer amount of time.
\end{enumerate}

    \begin{enumerate}
\def\labelenumi{\alph{enumi})}
\setcounter{enumi}{2}
\tightlist
\item
  Pros: With the 9\% you earn more money then if you just invest each
  year for one year, therefore it is more profitable.
\end{enumerate}

Cons: The investment is less flexible and riskier as mentioned above.

    \begin{enumerate}
\def\labelenumi{\alph{enumi})}
\setcounter{enumi}{3}
\tightlist
\item
  If we want to change from a 1 year investment to a 2 year investment
  before the start of the period there is nothing different needed. If
  we want to change during the year 1 then we would need to
\end{enumerate}

    \hypertarget{duration-of-a-coupon-bearing-bond}{%
\subsubsection{2.3 Duration of a coupon-bearing
bond}\label{duration-of-a-coupon-bearing-bond}}

    \hypertarget{section}{%
\paragraph{2.3.1}\label{section}}

    \begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  We can directly readd from the last row of the table:
\end{enumerate}

\[ 0.0124 + 0.0236 + 0.0337 + 0.0428 + 0.0510 + 0.0583 + 6.5377 = 6.7595 \]

Therefore we get 6.76 years for the duration.

    \begin{enumerate}
\def\labelenumi{\alph{enumi})}
\setcounter{enumi}{1}
\tightlist
\item
  We get the modified duration, with annual yield to maturity of 5\%,
  as:
\end{enumerate}

\[ \text{Modified duration} = \text{Volatility}(\%)=  \frac{\text{Duration}}{1+\text{yield}} = \frac{6.7595}{1+0.05} = 6.4376 \]

We see the duration is shorter than above, because of the yield. The
higher the yield the smaller the volatility.

    \begin{enumerate}
\def\labelenumi{\alph{enumi})}
\setcounter{enumi}{2}
\tightlist
\item
  The pension plan is usually a long term investment. Therefore we can
  make use of the long duration in order to stabilize the investment
  against unexpected changes of interest rates\ldots\ldots{} (?)
\end{enumerate}

    \hypertarget{capital-asset-pricing-model-capm-and-arbitrage-pricing-theory-apt}{%
\subsubsection{2.4 Capital Asset Pricing Model (CAPM) and Arbitrage
Pricing Theory
(APT)}\label{capital-asset-pricing-model-capm-and-arbitrage-pricing-theory-apt}}

    \hypertarget{average-return}{%
\paragraph{2.4.1 Average Return}\label{average-return}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{5}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{numpy} \PY{k}{as} \PY{n+nn}{np}
\PY{k+kn}{import} \PY{n+nn}{pandas} \PY{k}{as} \PY{n+nn}{pd}


\PY{n}{df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+sa}{r}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{fsp\PYZus{}case\PYZus{}31\PYZus{}BSD.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{n}{index\PYZus{}col}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{,}\PY{n}{header}\PY{o}{=}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
\PY{n}{df}\PY{o}{.}\PY{n}{index} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{to\PYZus{}datetime}\PY{p}{(}\PY{n}{df}\PY{o}{.}\PY{n}{index}\PY{p}{)}
\PY{n}{df} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{sort\PYZus{}index}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} fill the nan values with a zero return for example at the 25.12 or 26.12}
\PY{n}{df\PYZus{}fill} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{fillna}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{)}
\PY{c+c1}{\PYZsh{} drop nans for APT}
\PY{n}{df\PYZus{}drop} \PY{o}{=} \PY{n}{df}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{6}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} create a list of the daily average rerturns}
\PY{n}{daily\PYZus{}avg\PYZus{}returns} \PY{o}{=} \PY{n}{df\PYZus{}fill}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ret}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{daily\PYZus{}avg\PYZus{}returns\PYZus{}changed\PYZus{}index} \PY{o}{=} \PY{n}{daily\PYZus{}avg\PYZus{}returns}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
\PY{n}{daily\PYZus{}avg\PYZus{}returns\PYZus{}changed\PYZus{}index}\PY{o}{.}\PY{n}{index} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{to\PYZus{}datetime}\PY{p}{(}\PY{n}{daily\PYZus{}avg\PYZus{}returns\PYZus{}changed\PYZus{}index}\PY{o}{.}\PY{n}{index}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{7}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{dpi}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{daily\PYZus{}avg\PYZus{}returns\PYZus{}changed\PYZus{}index}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Average Return Per Day Over All Companies, Equally Weighted}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xticks}\PY{p}{(}\PY{n}{rotation}\PY{o}{=}\PY{l+m+mi}{45}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Date}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Average Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_108_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{8}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{dpi}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{daily\PYZus{}avg\PYZus{}returns\PYZus{}changed\PYZus{}index}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xticks}\PY{p}{(}\PY{n}{rotation}\PY{o}{=}\PY{l+m+mi}{45}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cummulative Return over 2 years, Unweighted Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Date}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cummulative Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_109_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{rolling-beta}{%
\paragraph{2.4.2 Rolling Beta}\label{rolling-beta}}

    We recall the definition of the beta, the beta is the ratio between the
covariance of an asset and the variance of the market. Therefore we get
the following graphs, mean and standart deviation for the 22 day rolling
Beta.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{9}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{cov\PYZus{}stocks} \PY{o}{=} \PY{n}{df\PYZus{}fill}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ret}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{22}\PY{p}{)}\PY{o}{.}\PY{n}{cov}\PY{p}{(}\PY{n}{daily\PYZus{}avg\PYZus{}returns}\PY{p}{)}
\PY{n}{var\PYZus{}market} \PY{o}{=} \PY{n}{daily\PYZus{}avg\PYZus{}returns}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{22}\PY{p}{)}\PY{o}{.}\PY{n}{var}\PY{p}{(}\PY{p}{)}
\PY{n}{betas} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{index}\PY{o}{=}\PY{n}{df\PYZus{}fill}\PY{o}{.}\PY{n}{index}\PY{p}{)}
\PY{k}{for} \PY{n}{company} \PY{o+ow}{in} \PY{n}{cov\PYZus{}stocks}\PY{p}{:}
    \PY{n}{betas}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+m+mi}{21}\PY{p}{:}\PY{p}{,}\PY{n}{company}\PY{p}{]} \PY{o}{=} \PY{n}{cov\PYZus{}stocks}\PY{p}{[}\PY{n}{company}\PY{p}{]}\PY{o}{/}\PY{n}{var\PYZus{}market}
\PY{n}{betas}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{n}{betas}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{:}\PY{l+m+mi}{21}\PY{p}{]}\PY{p}{,} \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{10}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{dpi}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{betas}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{betas}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xticks}\PY{p}{(}\PY{p}{[}\PY{n}{betas}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{n+nb}{len}\PY{p}{(}\PY{n}{betas}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{)}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{int}\PY{p}{)}\PY{p}{]}\PY{p}{,}\PY{n}{rotation}\PY{o}{=}\PY{l+m+mi}{45}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{22 day rolling Beta for all companies}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Date}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Estimated Beta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{betas}\PY{o}{.}\PY{n}{values}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{std:  }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{n}{betas}\PY{o}{.}\PY{n}{values}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_113_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
mean:  1.0000000000000004
std:   0.7742634277155881
    \end{Verbatim}

    From the mean and the standart deviation we see that on average the
stocks are perfectly correlated with the market (mean = 1), but also
averaging through the stocks, they are about 76\% more volatile than the
market itself.

    \hypertarget{cap-weighted-market-return}{%
\paragraph{2.4.3 Cap-weighted Market
Return}\label{cap-weighted-market-return}}

    We can interpret the weighting coefficient as giving a sense of the
bigger picture of the market cap. Since we divide by the sum of all
market caps we can therefore get a relative measure of each investment's
market cap. Therefore we get a value that is a fraction of the sum of
all market cap for each investment. This is important since oftentimes
in the real world one has not an evenly weighted portfolio.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{11}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{marketcap\PYZus{}tot} \PY{o}{=} \PY{n}{df\PYZus{}fill}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mcap}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{marketcap\PYZus{}tot} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{marketcap\PYZus{}tot}\PY{p}{)}
\PY{n}{numerator} \PY{o}{=} \PY{n}{df\PYZus{}fill}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ret}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{*}\PY{n}{df\PYZus{}fill}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mcap}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{asset\PYZus{}returns} \PY{o}{=} \PY{n}{numerator}\PY{o}{/}\PY{n}{marketcap\PYZus{}tot}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{market\PYZus{}returns} \PY{o}{=} \PY{n}{asset\PYZus{}returns}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{13}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{dpi}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{market\PYZus{}returns}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xticks}\PY{p}{(}\PY{p}{[}\PY{n}{betas}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{n+nb}{len}\PY{p}{(}\PY{n}{betas}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{)}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{int}\PY{p}{)}\PY{p}{]}\PY{p}{,}\PY{n}{rotation}\PY{o}{=}\PY{l+m+mi}{45}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cap\PYZhy{}weighted Market Return For Every Day }\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Date}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cap\PYZhy{}weighted Market Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_118_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{14}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{dpi}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{market\PYZus{}returns}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xticks}\PY{p}{(}\PY{p}{[}\PY{n}{betas}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{n+nb}{len}\PY{p}{(}\PY{n}{betas}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{)}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{int}\PY{p}{)}\PY{p}{]}\PY{p}{,}\PY{n}{rotation}\PY{o}{=}\PY{l+m+mi}{45}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cummulative Return over 2 years, Cap\PYZhy{}weighted Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Date}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cummulative Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_119_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    If we compare the cummulative return to the unweighted return, we see
much higher return. Therefore we see that bigger companies
i.e.~companies with a bigger fraction of the market tend to perform
better than smaller ones. Which is completely logical, since if they
perform well, investors will invest in them, giving them a bigger share
in the market.

    \hypertarget{rolling-beta-with-cap-weighted-market-returns}{%
\paragraph{2.4.4 Rolling Beta with Cap-weighted Market
Returns}\label{rolling-beta-with-cap-weighted-market-returns}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{15}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{cov\PYZus{}stocks\PYZus{}mr} \PY{o}{=} \PY{n}{df\PYZus{}fill}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ret}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{22}\PY{p}{)}\PY{o}{.}\PY{n}{cov}\PY{p}{(}\PY{n}{market\PYZus{}returns}\PY{p}{)}
\PY{n}{var\PYZus{}market\PYZus{}mr} \PY{o}{=} \PY{n}{market\PYZus{}returns}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{22}\PY{p}{)}\PY{o}{.}\PY{n}{var}\PY{p}{(}\PY{p}{)}
\PY{n}{betas\PYZus{}m} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{index}\PY{o}{=}\PY{n}{df\PYZus{}fill}\PY{o}{.}\PY{n}{index}\PY{p}{)}
\PY{k}{for} \PY{n}{company} \PY{o+ow}{in} \PY{n}{cov\PYZus{}stocks\PYZus{}mr}\PY{p}{:}
    \PY{n}{betas\PYZus{}m}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+m+mi}{21}\PY{p}{:}\PY{p}{,}\PY{n}{company}\PY{p}{]} \PY{o}{=} \PY{n}{cov\PYZus{}stocks\PYZus{}mr}\PY{p}{[}\PY{n}{company}\PY{p}{]}\PY{o}{/}\PY{n}{var\PYZus{}market\PYZus{}mr}
\PY{n}{betas\PYZus{}m}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{n}{betas\PYZus{}m}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{:}\PY{l+m+mi}{21}\PY{p}{]}\PY{p}{,} \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{16}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{dpi}\PY{o}{=}\PY{l+m+mi}{100}\PY{p}{,} \PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{betas\PYZus{}m}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{betas\PYZus{}m}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xticks}\PY{p}{(}\PY{p}{[}\PY{n}{betas\PYZus{}m}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{np}\PY{o}{.}\PY{n}{linspace}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{,}\PY{n+nb}{len}\PY{p}{(}\PY{n}{betas\PYZus{}m}\PY{o}{.}\PY{n}{index}\PY{p}{)}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{)}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{int}\PY{p}{)}\PY{p}{]}\PY{p}{,}\PY{n}{rotation}\PY{o}{=}\PY{l+m+mi}{45}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{22 day rolling Beta for all companies, cap\PYZhy{}weighted}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Date}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Estimated Beta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}

\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mean: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n}{betas\PYZus{}m}\PY{o}{.}\PY{n}{values}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{std:  }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{np}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{n}{betas\PYZus{}m}\PY{o}{.}\PY{n}{values}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_123_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{Verbatim}[commandchars=\\\{\}]
mean:  0.9066039347377957
std:   0.7162391915448689
    \end{Verbatim}

    We see that here is we get a smaller mean, which reflects the fact that
the average stocks are not perfectly correlated to the market anymore as
seen before. Also the standard deviation is smaller, so the volatility
is smaller than for an unweighted portfolio. This makes sense, since the
smaller, more volatile companies get weighted less with this technique.

    \hypertarget{arbitrage-pricing-theory}{%
\subsubsection{2.4.5 Arbitrage Pricing
Theory}\label{arbitrage-pricing-theory}}

    In the APT we assume that the expected return of an asset is a linear
combination of diverese factors. Here in this exercise we assume two
such linear factors. The model is given by:

\[ r_j = a + b_{m_i}R_m + b_{s_i}R_s + \epsilon_j \]

If we put everything into a matrix form we get:

\begin{equation}
    \begin{pmatrix}
        r_{1} \\
        r_{2} \\
        \vdots \\
        r_{n} \\
    \end{pmatrix}
    =
    \begin{pmatrix}
        1 & b_{m,1} & b_{s,1} \\
        1 & b_{m,2} & b_{s,2} \\
        \vdots & \vdots & \vdots \\
        1 & b_{m,n} & b_{s,n}\\
    \end{pmatrix}
    \begin{pmatrix}
        a \\
        R_m \\
        R_s\\
    \end{pmatrix}
    +
    \begin{pmatrix}
        \epsilon_1 \\
        \epsilon_2 \\
        \vdots \\
        \epsilon_n \\
    \end{pmatrix}
\end{equation}

\[ \textbf{R = Ax + E} \]

Which we transform to:

\[ \textbf{x} = (\textbf{A}^T\textbf{A})^{-1}\textbf{A}^T\textbf{(R-E)} \]

We get the \((\textbf{A}^T\textbf{A})^{-1}\textbf{A}^T\) term, since we
cannot directly invert \(\textbf{A}\).

We can now calculate the \$ a \$, \$ R\_m \$ and \$ R\_s \$ by solving
the linear system of equations. Since for the values in A we, as seen
beofre, can consider the 22-day rolliin beta as sensitivity to the
market returns and we also have that \(b_{s_i} = ln(size)\).

    \begin{enumerate}
\def\labelenumi{\alph{enumi})}
\tightlist
\item
  Estimate \$ a \$, \$ R\_m \$ and \$ R\_s \$
\end{enumerate}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{17}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} get the betas}
\PY{n}{cov\PYZus{}stocks\PYZus{}mr} \PY{o}{=} \PY{n}{df\PYZus{}drop}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ret}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{22}\PY{p}{)}\PY{o}{.}\PY{n}{cov}\PY{p}{(}\PY{n}{market\PYZus{}returns}\PY{p}{)}
\PY{n}{var\PYZus{}market\PYZus{}mr} \PY{o}{=} \PY{n}{market\PYZus{}returns}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{22}\PY{p}{)}\PY{o}{.}\PY{n}{var}\PY{p}{(}\PY{p}{)}
\PY{n}{betas\PYZus{}m} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{index}\PY{o}{=}\PY{n}{df\PYZus{}fill}\PY{o}{.}\PY{n}{index}\PY{p}{)}
\PY{k}{for} \PY{n}{company} \PY{o+ow}{in} \PY{n}{cov\PYZus{}stocks\PYZus{}mr}\PY{p}{:}
    \PY{n}{betas\PYZus{}m}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+m+mi}{21}\PY{p}{:}\PY{p}{,}\PY{n}{company}\PY{p}{]} \PY{o}{=} \PY{n}{cov\PYZus{}stocks\PYZus{}mr}\PY{p}{[}\PY{n}{company}\PY{p}{]}\PY{o}{/}\PY{n}{var\PYZus{}market\PYZus{}mr}
\PY{n}{betas\PYZus{}m}\PY{o}{.}\PY{n}{drop}\PY{p}{(}\PY{n}{betas\PYZus{}m}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{:}\PY{l+m+mi}{21}\PY{p}{]}\PY{p}{,} \PY{n}{inplace}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{18}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{index} \PY{o}{=} \PY{n}{df\PYZus{}drop}\PY{o}{.}\PY{n}{index}\PY{o}{.}\PY{n}{intersection}\PY{p}{(}\PY{n}{betas\PYZus{}m}\PY{o}{.}\PY{n}{index}\PY{p}{)}
\PY{n}{returns} \PY{o}{=} \PY{n}{df\PYZus{}drop}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{ret}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{index}\PY{p}{]}

\PY{n}{b\PYZus{}m} \PY{o}{=} \PY{n}{betas\PYZus{}m}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
\PY{n}{b\PYZus{}m} \PY{o}{=} \PY{n}{b\PYZus{}m}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{index}\PY{p}{]}
\PY{n}{b\PYZus{}s} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{df\PYZus{}drop}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mcap}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{index}\PY{p}{]}\PY{p}{)}

\PY{n}{R\PYZus{}m} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{index} \PY{o}{=} \PY{n}{returns}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float64}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{R\PYZus{}s} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{index} \PY{o}{=} \PY{n}{returns}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float64}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{a} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{index} \PY{o}{=} \PY{n}{returns}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{dtype}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float64}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{e} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{index} \PY{o}{=} \PY{n}{returns}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{columns} \PY{o}{=} \PY{n}{returns}\PY{o}{.}\PY{n}{columns}\PY{p}{)}

\PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{returns}\PY{o}{.}\PY{n}{index}\PY{p}{:}
    \PY{n}{r\PYZus{}i} \PY{o}{=} \PY{n}{returns}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
    \PY{n}{b\PYZus{}m\PYZus{}i} \PY{o}{=} \PY{n}{b\PYZus{}m}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
    \PY{n}{b\PYZus{}s\PYZus{}i} \PY{o}{=} \PY{n}{b\PYZus{}s}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{values}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
    \PY{n}{ones\PYZus{}matrix} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{ones}\PY{p}{(}\PY{p}{(}\PY{n}{r\PYZus{}i}\PY{o}{.}\PY{n}{shape}\PY{p}{)}\PY{p}{)}
    \PY{n}{A} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{hstack}\PY{p}{(}\PY{p}{(}\PY{n}{ones\PYZus{}matrix}\PY{p}{,} \PY{n}{b\PYZus{}m\PYZus{}i}\PY{p}{,} \PY{n}{b\PYZus{}s\PYZus{}i}\PY{p}{)}\PY{p}{)}

    \PY{n}{x} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{inv}\PY{p}{(}\PY{n}{A}\PY{o}{.}\PY{n}{T}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{A}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{A}\PY{o}{.}\PY{n}{T}\PY{p}{)}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{r\PYZus{}i}\PY{p}{)}
    
    \PY{n}{a}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{x}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}
    \PY{n}{R\PYZus{}m}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{x}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
    \PY{n}{R\PYZus{}s}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{x}\PY{p}{[}\PY{l+m+mi}{2}\PY{p}{]}\PY{p}{)}
    \PY{n}{e}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{n}{r\PYZus{}i}\PY{o}{\PYZhy{}}\PY{n}{A}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{x}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    Now we have a a, R\_m and a R\_s for each day.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{19}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{np}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{n}{betas\PYZus{}m}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{19}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
70500
\end{Verbatim}
\end{tcolorbox}
        
    \begin{enumerate}
\def\labelenumi{\alph{enumi})}
\setcounter{enumi}{1}
\tightlist
\item
  To have a better look at the Magnitude and Variance of the parameters,
  we can plot them and their distribution.
\end{enumerate}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{25}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig}\PY{p}{,} \PY{p}{(}\PY{n}{ax1}\PY{p}{,} \PY{n}{ax2}\PY{p}{,} \PY{n}{ax3}\PY{p}{)} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{,} \PY{n}{figsize} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{15}\PY{p}{)}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{2\PYZhy{}Factor APT}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{14}\PY{p}{)}
\PY{n}{R\PYZus{}m}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{legend}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax1}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Market Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{grid}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{ylabel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{R\PYZus{}m}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{R\PYZus{}s}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{legend}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax2}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Size Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{grid}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{ylabel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{R\PYZus{}s}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{a}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{legend}\PY{o}{=}\PY{k+kc}{False}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax3}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Alpha}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{grid}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{ylabel}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{a}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax1}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{hist}\PY{p}{(}\PY{n}{R\PYZus{}m}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{)}
\PY{n}{ax1}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Density Distribution Market Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax1}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
\PY{n}{ax1}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{R\PYZus{}m Magnitude}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{hist}\PY{p}{(}\PY{n}{R\PYZus{}s}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{)}
\PY{n}{ax2}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Density Distribution Size Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
\PY{n}{ax2}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{R\PYZus{}s Magnitude}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax3}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{hist}\PY{p}{(}\PY{n}{a}\PY{p}{,} \PY{l+m+mi}{100}\PY{p}{)}
\PY{n}{ax3}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Density Distribution a}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax3}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
\PY{n}{ax3}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{a Magnitude}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}

\PY{n}{ParamsStats} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{index}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{R\PYZus{}m}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{R\PYZus{}s}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{a}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{columns}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{S.D.}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
\PY{n}{ParamsStats}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{R\PYZus{}m}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=}\PY{p}{[}\PY{n}{R\PYZus{}m}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{R\PYZus{}m}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{]}
\PY{n}{ParamsStats}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{R\PYZus{}s}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=}\PY{p}{[}\PY{n}{R\PYZus{}s}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{R\PYZus{}s}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{]}
\PY{n}{ParamsStats}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{a}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=}\PY{p}{[}\PY{n}{a}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{a}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{]}

\PY{n}{ParamsStats}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{25}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
         Mean      S.D.
R\_m -0.000288  0.007871
R\_s  0.000193  0.001733
a   -0.004234  0.041209
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_133_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    From the probability density histograms we see that we get some nice
gaussian distributions. But none of the factors really shows us the
market trend that we found before of going up.

    \begin{enumerate}
\def\labelenumi{\alph{enumi})}
\setcounter{enumi}{2}
\tightlist
\item
\end{enumerate}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{33}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{correlations} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{index}\PY{o}{=}\PY{n}{e}\PY{o}{.}\PY{n}{columns}\PY{p}{)}

\PY{k}{for} \PY{n}{company} \PY{o+ow}{in} \PY{n}{e}\PY{o}{.}\PY{n}{columns}\PY{p}{:}
    \PY{n}{correlations}\PY{p}{[}\PY{n}{company}\PY{p}{]} \PY{o}{=} \PY{n}{pearsonr}\PY{p}{(}\PY{n}{e}\PY{p}{[}\PY{n}{company}\PY{p}{]}\PY{p}{,} \PY{n}{returns}\PY{p}{[}\PY{n}{company}\PY{p}{]}\PY{p}{)}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}

\PY{n}{correlations}\PY{o}{.}\PY{n}{hist}\PY{p}{(}\PY{n}{bins}\PY{o}{=}\PY{l+m+mi}{20}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Correlation Histogram}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Corrleation}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Count}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}

\PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{correlations}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{S.D.}\PY{l+s+s2}{\PYZdq{}}\PY{p}{:} \PY{n}{correlations}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}\PY{p}{\PYZcb{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{33}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
Mean    0.811413
S.D.    0.075935
dtype: float64
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_136_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    As the e is the specific return, we would expect it's mean to be near
zero if the model would fit goodly to the returns over time. As we see
this is not the case and therefore this ARP 2-factor model does not
fully explain the return over time of the assets.

    \begin{enumerate}
\def\labelenumi{\alph{enumi})}
\setcounter{enumi}{3}
\tightlist
\item
  We can look at the rate of change in order to know about the stability
  of the model. Since we see the big red spikes at arbitrary times in
  our plot we can conclude as said before, that the two factor model is
  not enough to explain the returns. That's because the big spikes show
  a big change in relation of the two \(R_m\) and \(R_s\) and therefore
  they change unpredictable and really fast to each other.
\end{enumerate}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{81}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{R} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{R\PYZus{}m}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{R\PYZus{}s}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]}\PY{p}{)}
\PY{n}{R}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{R\PYZus{}m}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{=} \PY{n}{R\PYZus{}m}
\PY{n}{R}\PY{p}{[}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{R\PYZus{}s}\PY{l+s+s2}{\PYZdq{}}\PY{p}{]} \PY{o}{=} \PY{n}{R\PYZus{}s}

\PY{n}{R\PYZus{}mat} \PY{o}{=} \PY{p}{[}\PY{p}{]}

\PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n}{R}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{l+m+mi}{21}\PY{p}{:}\PY{p}{]}\PY{p}{:}
    \PY{n}{R\PYZus{}T} \PY{o}{=} \PY{n}{R}\PY{p}{[}\PY{p}{:}\PY{n}{i}\PY{p}{]}\PY{p}{[}\PY{o}{\PYZhy{}}\PY{l+m+mi}{22}\PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{transpose}\PY{p}{(}\PY{p}{)}
    \PY{n}{R\PYZus{}mat}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{cov}\PY{p}{(}\PY{n}{R\PYZus{}T}\PY{p}{)}\PY{p}{)}
    
\PY{n}{R\PYZus{}mat} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{array}\PY{p}{(}\PY{n}{R\PYZus{}mat}\PY{p}{)}

\PY{n}{roll\PYZus{}mag} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{index} \PY{o}{=} \PY{n}{R}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{l+m+mi}{21}\PY{p}{:}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{roll\PYZus{}stab} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{index} \PY{o}{=} \PY{n}{R}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{l+m+mi}{21}\PY{p}{:}\PY{p}{]}\PY{p}{,} \PY{n}{dtype} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n}{R\PYZus{}mat}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}
    \PY{n}{current\PYZus{}R} \PY{o}{=} \PY{n}{R\PYZus{}mat}\PY{p}{[}\PY{n}{i}\PY{p}{]}
    \PY{n}{roll\PYZus{}mag}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{norm}\PY{p}{(}\PY{n}{current\PYZus{}R}\PY{p}{)}\PY{p}{)}
    
    \PY{n}{previous\PYZus{}R} \PY{o}{=} \PY{n}{R\PYZus{}mat}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}
    \PY{n}{roll\PYZus{}stab}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{100} \PY{o}{*} \PY{n}{np}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{n+nb}{abs}\PY{p}{(}\PY{p}{(}\PY{n}{current\PYZus{}R} \PY{o}{\PYZhy{}} \PY{n}{previous\PYZus{}R}\PY{p}{)}\PY{o}{/} \PY{n}{previous\PYZus{}R}\PY{p}{)}\PY{p}{)}\PY{p}{)}

\PY{n}{fig} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{p}{)}
\PY{n}{ax1} \PY{o}{=} \PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}subplot}\PY{p}{(}\PY{l+m+mi}{111}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{roll\PYZus{}mag}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cov(R)}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xticks}\PY{p}{(}\PY{n}{rotation}\PY{o}{=}\PY{l+m+mi}{45}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cov(R) and the average percentage change}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax2} \PY{o}{=} \PY{n}{ax1}\PY{o}{.}\PY{n}{twinx}\PY{p}{(}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{roll\PYZus{}stab}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.6}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Average percentage change}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{k}{for} \PY{n}{tl} \PY{o+ow}{in} \PY{n}{ax2}\PY{o}{.}\PY{n}{get\PYZus{}yticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{:}
    \PY{n}{tl}\PY{o}{.}\PY{n}{set\PYZus{}color}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_139_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{enumerate}
\def\labelenumi{\alph{enumi})}
\setcounter{enumi}{4}
\tightlist
\item
  We take over e from 5a), calculate it's covariance matrix and
  calulcate the eigenvalues of the covariance matrix. This eigenvalues
  are then the principal components of the matrix \(E\).
\end{enumerate}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{102}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{eigvalues}\PY{p}{,}\PY{n}{\PYZus{}} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{eigh}\PY{p}{(}\PY{n}{e}\PY{o}{.}\PY{n}{astype}\PY{p}{(}\PY{n+nb}{float}\PY{p}{)}\PY{o}{.}\PY{n}{cov}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{n}{cum\PYZus{}var} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{n}{eigvalues}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{o}{/}\PY{n+nb}{sum}\PY{p}{(}\PY{n}{eigvalues}\PY{p}{)}\PY{o}{*}\PY{l+m+mi}{100}\PY{p}{)}

\PY{n}{fig} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{figure}\PY{p}{(}\PY{n}{figsize}\PY{o}{=}\PY{p}{(}\PY{l+m+mi}{8}\PY{p}{,}\PY{l+m+mi}{6}\PY{p}{)}\PY{p}{)}
\PY{n}{ax1} \PY{o}{=} \PY{n}{fig}\PY{o}{.}\PY{n}{add\PYZus{}subplot}\PY{p}{(}\PY{l+m+mi}{111}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{eigvalues}\PY{p}{[}\PY{p}{:}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
\PY{n}{ax1}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Eigenvalues}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xticks}\PY{p}{(}\PY{n}{rotation}\PY{o}{=}\PY{l+m+mi}{45}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Eigenvalues and their explained cummulative variance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{ax2} \PY{o}{=} \PY{n}{ax1}\PY{o}{.}\PY{n}{twinx}\PY{p}{(}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{cum\PYZus{}var}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Explained cummulative variance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{axhline}\PY{p}{(}\PY{n}{y} \PY{o}{=} \PY{l+m+mi}{90}\PY{p}{,} \PY{n}{linestyle} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linewidth} \PY{o}{=} \PY{l+m+mi}{2}\PY{p}{,} \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.4}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{90}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{ Information}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{ax2}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{)}
\PY{k}{for} \PY{n}{tl} \PY{o+ow}{in} \PY{n}{ax2}\PY{o}{.}\PY{n}{get\PYZus{}yticklabels}\PY{p}{(}\PY{p}{)}\PY{p}{:}
    \PY{n}{tl}\PY{o}{.}\PY{n}{set\PYZus{}color}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{The explained variance of the first component is: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n+nb}{round}\PY{p}{(}\PY{n}{cum\PYZus{}var}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{\PYZsq{}} \PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{The explained variance of the first and second component is: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n+nb}{round}\PY{p}{(}\PY{n}{cum\PYZus{}var}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{\PYZsq{}} \PY{p}{)}
\PY{n+nb}{print}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{The explained variance of the first and second component is: }\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n+nb}{round}\PY{p}{(}\PY{n}{cum\PYZus{}var}\PY{p}{[}\PY{l+m+mi}{50}\PY{p}{]}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{\PYZsq{}} \PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{Verbatim}[commandchars=\\\{\}]
The explained variance of the first component is:  7.3543 \%
The explained variance of the first and second component is:  12.3672 \%
The explained variance of the first and second component is:  79.6691 \%
    \end{Verbatim}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_141_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    We see that the first two principal components only explain a small
percentage of the variance. This observation is in line with the
observations from before, where we saw that the two factor model is to
simple to explain the returns.

    \hypertarget{portfolio-optimization}{%
\subsection{3 Portfolio Optimization}\label{portfolio-optimization}}

    \hypertarget{adaptive-minimum-variance-portfolio-optimization}{%
\subsubsection{3.1 Adaptive minimum-variance portfolio
optimization}\label{adaptive-minimum-variance-portfolio-optimization}}

    \hypertarget{section}{%
\paragraph{3.1.1}\label{section}}

    Our task is to find the optimal value for the weights such that the
variance of the portfolio is minimal.

We can directly take the lagrangian that is proposed in the exercise:

\[ 
L = \frac{1}{2} \textbf{w}^T\textbf{C}\textbf{w} - \lambda (\textbf{w}^T \textbf{1} - 1) 
\]

Now we differentiate with respect to \(\textbf{w}\) giving us
\(\textbf{w}_{opt}\) which stands for the optimal set of weights:

\[ 
\frac{\partial L}{ \partial \textbf{w}} = \textbf{C}\textbf{w}_{opt} - \lambda \textbf{1} 
\]

Setting the derivative to zero to obtain the optimum gives us:

\[
0 = \textbf{C}\textbf{w}_{opt} - \lambda \textbf{1} \Rightarrow \textbf{w}_{opt} = \lambda \textbf{C}^{-1} \textbf{1}
\]

Now differentiating with respect to \(\lambda\), setting the derivative
to 0 we get:

\[
\frac{\partial L}{ \partial \lambda} = \textbf{w}_{opt}^T \textbf{1} - 1 = 0 \Rightarrow \textbf{w}_{opt}^T \textbf{1} = 1 
\]

Now we can substitute the first equation into the second to get:

\[ 
\lambda \textbf{1}^T \textbf{C}^{-1} \textbf{1} = 1 
\]

Solving for \(\lambda\)

\[
\lambda = \frac{1}{\textbf{1}^T \textbf{C}^{-1} \textbf{1}}
\]

Substituting to equation third equation we get:

\[
\textbf{w}_{opt} = \frac{\textbf{C}^{-1} \textbf{1}}{\textbf{1}^T \textbf{C}^{-1} \textbf{1}}
\]

Now to get the variance of the optimal portfolio we can just plug in the
value we found for \(\textbf{w}_{opt}\)

\[ 
\bar{\mu}_{opt} = \textbf{w}_{opt}^{T} \mu =  
        \frac{C^{-1} \textbf{1}}{\textbf{1}^T \textbf{C}^{-1} \textbf{1}} \mu
\]

\[
\bar{\sigma}^{2}_{opt} = \textbf{w}_{opt}^{T}\textbf{C}\textbf{w}_{opt} = 
    \frac{1}{\textbf{1}^T \textbf{C}^{-1} \textbf{1}} = \lambda
\]

    \hypertarget{section}{%
\paragraph{3.1.2}\label{section}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{117}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} basic data preprocessing}
\PY{n}{df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{fsp\PYZus{}case\PYZus{}31\PYZus{}BSD.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{index\PYZus{}col} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{,} \PY{n}{header} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{0} \PY{p}{,}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)} 
\PY{n}{returns} \PY{o}{=} \PY{n}{df}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ret}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{fillna}\PY{p}{(}\PY{l+m+mi}{0}\PY{p}{)} 
\PY{n}{returns}\PY{o}{.}\PY{n}{index} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{to\PYZus{}datetime}\PY{p}{(}\PY{n}{returns}\PY{o}{.}\PY{n}{index}\PY{p}{)} 
\PY{n}{returns} \PY{o}{=} \PY{n}{returns}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{p}{:}\PY{p}{,} \PY{o}{\PYZhy{}}\PY{l+m+mi}{10}\PY{p}{:}\PY{p}{]}

\PY{c+c1}{\PYZsh{} split}
\PY{n}{train\PYZus{}returns} \PY{o}{=} \PY{n}{returns}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{p}{:}\PY{n+nb}{int}\PY{p}{(}\PY{n}{returns}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{,} \PY{p}{:}\PY{p}{]}
\PY{n}{test\PYZus{}returns}  \PY{o}{=} \PY{n}{returns}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{n+nb}{int}\PY{p}{(}\PY{n}{returns}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{:}\PY{p}{,} \PY{p}{:}\PY{p}{]}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{118}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} since we have a equally weighted portfolio, we can just take the mean of the data to get the resulting portfolio returns}

\PY{n}{equally\PYZus{}weighted\PYZus{}portfolio\PYZus{}train} \PY{o}{=} \PY{n}{train\PYZus{}returns}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{equally\PYZus{}weighted\PYZus{}portfolio\PYZus{}test}  \PY{o}{=} \PY{n}{test\PYZus{}returns}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}

\PY{n}{fig}\PY{p}{,} \PY{p}{(}\PY{n}{ax1}\PY{p}{,} \PY{n}{ax2}\PY{p}{)} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Equally Weighted Portfolio Performance Analysis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{12}\PY{p}{,} \PY{n}{fontweight}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{bold}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{6}\PY{p}{)}
\PY{n}{equally\PYZus{}weighted\PYZus{}portfolio\PYZus{}train}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{grid}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Daily Return Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax1}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{equally\PYZus{}weighted\PYZus{}portfolio\PYZus{}train}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{grid}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cumulative Daily Return Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax1}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}

\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{6}\PY{p}{)}
\PY{n}{equally\PYZus{}weighted\PYZus{}portfolio\PYZus{}test}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{grid}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Daily Return Test}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax2}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{equally\PYZus{}weighted\PYZus{}portfolio\PYZus{}test}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{grid}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cumulative Daily Return Test}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax2}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{}optimal weights train}

\PY{n}{ones} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{ones}\PY{p}{(}\PY{n}{train\PYZus{}returns}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
\PY{n}{C} \PY{o}{=} \PY{n}{train\PYZus{}returns}\PY{o}{.}\PY{n}{cov}\PY{p}{(}\PY{p}{)}
\PY{n}{tvar\PYZus{}lambda\PYZus{}train} \PY{o}{=} \PY{l+m+mi}{1}\PY{o}{/}\PY{p}{(}\PY{n}{ones}\PY{o}{.}\PY{n}{T}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{inv}\PY{p}{(}\PY{n}{C}\PY{p}{)}\PY{o}{.}\PY{n}{T}\PY{p}{)}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{ones}\PY{p}{)}\PY{p}{)}
\PY{n}{Lambda} \PY{o}{=} \PY{l+m+mi}{1}\PY{o}{/}\PY{p}{(}\PY{n}{ones}\PY{o}{.}\PY{n}{T}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{inv}\PY{p}{(}\PY{n}{C}\PY{p}{)}\PY{o}{.}\PY{n}{T}\PY{p}{)}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{ones}\PY{p}{)}\PY{p}{)}
\PY{n}{w\PYZus{}opt} \PY{o}{=} \PY{n}{Lambda}\PY{o}{*}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{inv}\PY{p}{(}\PY{n}{C}\PY{p}{)}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{ones}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}

\PY{n}{optimally\PYZus{}weighted\PYZus{}portfolio\PYZus{}train} \PY{o}{=} \PY{p}{(}\PY{n}{train\PYZus{}returns}\PY{o}{*}\PY{n}{w\PYZus{}opt}\PY{p}{)}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}

\PY{n}{fig}\PY{p}{,} \PY{p}{(}\PY{n}{ax1}\PY{p}{,} \PY{n}{ax2}\PY{p}{)} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+sa}{f}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Optimally Weighted Portfolio Performance Analysis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{12}\PY{p}{,} \PY{n}{fontweight}\PY{o}{=}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{bold}\PY{l+s+s2}{\PYZdq{}}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{6}\PY{p}{)}
\PY{n}{optimally\PYZus{}weighted\PYZus{}portfolio\PYZus{}train}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{grid}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Daily Return Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax1}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{optimally\PYZus{}weighted\PYZus{}portfolio\PYZus{}train}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{grid}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cumulative Daily Return Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax1}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{}optimal weights test}

\PY{n}{ones} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{ones}\PY{p}{(}\PY{n}{test\PYZus{}returns}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}
\PY{n}{C} \PY{o}{=} \PY{n}{test\PYZus{}returns}\PY{o}{.}\PY{n}{cov}\PY{p}{(}\PY{p}{)}
\PY{n}{tvar\PYZus{}lambda\PYZus{}test} \PY{o}{=} \PY{l+m+mi}{1}\PY{o}{/}\PY{p}{(}\PY{n}{ones}\PY{o}{.}\PY{n}{T}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{inv}\PY{p}{(}\PY{n}{C}\PY{p}{)}\PY{o}{.}\PY{n}{T}\PY{p}{)}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{ones}\PY{p}{)}\PY{p}{)}
\PY{n}{Lambda} \PY{o}{=} \PY{l+m+mi}{1}\PY{o}{/}\PY{p}{(}\PY{n}{ones}\PY{o}{.}\PY{n}{T}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{inv}\PY{p}{(}\PY{n}{C}\PY{p}{)}\PY{o}{.}\PY{n}{T}\PY{p}{)}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{ones}\PY{p}{)}\PY{p}{)}
\PY{n}{w\PYZus{}opt} \PY{o}{=} \PY{n}{Lambda}\PY{o}{*}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{inv}\PY{p}{(}\PY{n}{C}\PY{p}{)}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{ones}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}

\PY{n}{optimally\PYZus{}weighted\PYZus{}portfolio\PYZus{}test} \PY{o}{=} \PY{p}{(}\PY{n}{test\PYZus{}returns}\PY{o}{*}\PY{n}{w\PYZus{}opt}\PY{p}{)}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}

\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{6}\PY{p}{)}
\PY{n}{optimally\PYZus{}weighted\PYZus{}portfolio\PYZus{}test}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{grid}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Daily Return Test}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax2}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{optimally\PYZus{}weighted\PYZus{}portfolio\PYZus{}test}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{grid}\PY{o}{=}\PY{k+kc}{True}\PY{p}{,} \PY{n}{title}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cumulative Daily Return Test}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ax}\PY{o}{=}\PY{n}{ax2}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_149_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_149_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{119}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{ParamsStats} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Mean Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cummulative Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Variance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Theoretical Variance}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
\PY{n}{ParamsStats}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Eq Weights Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=}\PY{p}{[}\PY{n}{equally\PYZus{}weighted\PYZus{}portfolio\PYZus{}train}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{equally\PYZus{}weighted\PYZus{}portfolio\PYZus{}train}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{equally\PYZus{}weighted\PYZus{}portfolio\PYZus{}train}\PY{o}{.}\PY{n}{var}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{ParamsStats}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Eq Weights Test}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=}\PY{p}{[}\PY{n}{equally\PYZus{}weighted\PYZus{}portfolio\PYZus{}test}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{equally\PYZus{}weighted\PYZus{}portfolio\PYZus{}test}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{equally\PYZus{}weighted\PYZus{}portfolio\PYZus{}test}\PY{o}{.}\PY{n}{var}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{\PYZhy{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{ParamsStats}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Opt Weights Train}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=}\PY{p}{[}\PY{n}{optimally\PYZus{}weighted\PYZus{}portfolio\PYZus{}train}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{optimally\PYZus{}weighted\PYZus{}portfolio\PYZus{}train}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{optimally\PYZus{}weighted\PYZus{}portfolio\PYZus{}train}\PY{o}{.}\PY{n}{var}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{tvar\PYZus{}lambda\PYZus{}train}\PY{p}{]}
\PY{n}{ParamsStats}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Opt Weights Test}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=}\PY{p}{[}\PY{n}{optimally\PYZus{}weighted\PYZus{}portfolio\PYZus{}test}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{optimally\PYZus{}weighted\PYZus{}portfolio\PYZus{}test}\PY{o}{.}\PY{n}{sum}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{optimally\PYZus{}weighted\PYZus{}portfolio\PYZus{}test}\PY{o}{.}\PY{n}{var}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{tvar\PYZus{}lambda\PYZus{}test}\PY{p}{]}

\PY{n}{ParamsStats}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{119}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
                   Mean Return  Cummulative Return  Variance  \textbackslash{}
Eq Weights Train      0.000860            0.223484  0.000037
Eq Weights Test      -0.000473           -0.123503  0.000079
Opt Weights Train     0.000958            0.249062  0.000029
Opt Weights Test     -0.000160           -0.041823  0.000058

                  Theoretical Variance
Eq Weights Train                     -
Eq Weights Test                      -
Opt Weights Train             0.000029
Opt Weights Test              0.000058
\end{Verbatim}
\end{tcolorbox}
        
    We see that the optimally weighted portfolio performs better than the
equally weighted portfolio, but still it's a negative cummulative
return. Even though during the training phase both portfolios had a good
performance. This shows how unpredictable the stock market is if you're
timeframe is too small. One idea to improve this would be to use a
longer training period.

For the variance we see that the experimentally calculated variance
matches the theoretical variance exactly.

    \hypertarget{section}{%
\subsubsection{3.1.3}\label{section}}

    We analyze the behavior of different window sizes on our cummulative
returns and on our volatility. Here we took the sizes in days: 22, 44,
110, 220, 330.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{186}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{windows} \PY{o}{=}  \PY{p}{[}\PY{l+m+mi}{22} \PY{o}{*} \PY{n}{i} \PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{p}{[}\PY{l+m+mi}{1}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{,} \PY{l+m+mi}{10}\PY{p}{,} \PY{l+m+mi}{15}\PY{p}{]}\PY{p}{]}
\PY{n}{adapt\PYZus{}returns} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{n}{variances} \PY{o}{=} \PY{p}{[}\PY{p}{]}
\PY{n}{cum\PYZus{}returns} \PY{o}{=} \PY{p}{[}\PY{p}{]}

\PY{k}{for} \PY{n}{w} \PY{o+ow}{in} \PY{n}{windows}\PY{p}{:}  
    
    \PY{n}{adaptive\PYZus{}portfolio} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{Series}\PY{p}{(}\PY{n}{dtype} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{float64}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)} 
    \PY{n}{returns\PYZus{}logging} \PY{o}{=} \PY{p}{[}\PY{p}{]}
    
    \PY{k}{for} \PY{n}{t} \PY{o+ow}{in} \PY{n}{test\PYZus{}returns}\PY{o}{.}\PY{n}{index}\PY{p}{:} 
        \PY{n}{curr\PYZus{}return} \PY{o}{=} \PY{n}{returns}\PY{p}{[}\PY{p}{:}\PY{n}{t}\PY{p}{]}\PY{o}{.}\PY{n}{iloc}\PY{p}{[}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{n}{w}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]} 
        \PY{n}{C} \PY{o}{=} \PY{n}{curr\PYZus{}return}\PY{o}{.}\PY{n}{cov}\PY{p}{(}\PY{p}{)}   
        \PY{n}{ones} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{ones}\PY{p}{(}\PY{n}{curr\PYZus{}return}\PY{o}{.}\PY{n}{shape}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}

        \PY{n}{tvar\PYZus{}lambda\PYZus{}test} \PY{o}{=} \PY{l+m+mi}{1}\PY{o}{/}\PY{p}{(}\PY{n}{ones}\PY{o}{.}\PY{n}{T}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{inv}\PY{p}{(}\PY{n}{C}\PY{p}{)}\PY{o}{.}\PY{n}{T}\PY{p}{)}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{ones}\PY{p}{)}\PY{p}{)}
        \PY{n}{Lambda} \PY{o}{=} \PY{l+m+mi}{1}\PY{o}{/}\PY{p}{(}\PY{n}{ones}\PY{o}{.}\PY{n}{T}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{inv}\PY{p}{(}\PY{n}{C}\PY{p}{)}\PY{o}{.}\PY{n}{T}\PY{p}{)}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{ones}\PY{p}{)}\PY{p}{)}
        \PY{n}{opt\PYZus{}weights} \PY{o}{=} \PY{n}{Lambda}\PY{o}{*}\PY{p}{(}\PY{n}{np}\PY{o}{.}\PY{n}{linalg}\PY{o}{.}\PY{n}{inv}\PY{p}{(}\PY{n}{C}\PY{p}{)}\PY{o}{.}\PY{n}{dot}\PY{p}{(}\PY{n}{ones}\PY{p}{)}\PY{p}{)}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{)}
        
        \PY{n}{adaptive\PYZus{}portfolio}\PY{p}{[}\PY{n}{t}\PY{p}{]} \PY{o}{=} \PY{n+nb}{sum}\PY{p}{(}\PY{n}{test\PYZus{}returns}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{t}\PY{p}{]} \PY{o}{*} \PY{n}{opt\PYZus{}weights}\PY{p}{)}  
        \PY{n}{returns\PYZus{}logging}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{adaptive\PYZus{}portfolio}\PY{p}{[}\PY{n}{t}\PY{p}{]}\PY{p}{)}
        
    \PY{c+c1}{\PYZsh{} Log returns and variances.}
    \PY{n}{adapt\PYZus{}returns}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{returns\PYZus{}logging}\PY{p}{)}
    \PY{n}{variances}\PY{o}{.}\PY{n}{append}\PY{p}{(}\PY{n}{adaptive\PYZus{}portfolio}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)} \PY{o}{*}\PY{o}{*} \PY{l+m+mi}{2}\PY{p}{)}
    
    \PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{adaptive\PYZus{}portfolio}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{p}{)}\PY{p}{)}
    \PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cummulative Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dates}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    
    \PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adaptive Time\PYZhy{}varying Minimum Variance Portfolio, Different Windows}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{k+kc}{True}\PY{p}{)}
    \PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{windows}\PY{p}{)}
    
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_154_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    We see that shorter periods give us better results, generally speaking.
With the shorter periods we're able to handle fast market movements
better and thus get a better performance. If we consider the 220 and 330
days windows, we see that both are behaving simillarly. So we can
conclude that beginning from a certain window size between 110 and 220
there is a size from which on the returns behave strongly simillar to
each other.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{292}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{,} \PY{n}{figsize} \PY{o}{=} \PY{p}{(}\PY{l+m+mi}{13}\PY{p}{,} \PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+s2}{\PYZdq{}}\PY{l+s+s2}{Adaptive Time\PYZhy{}varying Minimum Variance Portfolio With Different Rolling Windows}\PY{l+s+s2}{\PYZdq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=}\PY{l+m+mi}{18}\PY{p}{)}
\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Magnitude}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{k}{for} \PY{n}{i} \PY{o+ow}{in} \PY{n+nb}{range}\PY{p}{(}\PY{n+nb}{len}\PY{p}{(}\PY{n}{windows}\PY{p}{)}\PY{p}{)}\PY{p}{:}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{hist}\PY{p}{(}\PY{n}{adapt\PYZus{}returns}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{l+m+mi}{30}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Window: }\PY{l+s+s1}{\PYZsq{}}\PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n}{windows}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{d}\PY{l+s+s1}{\PYZsq{}} \PY{o}{+} 
                    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{ Variance: }\PY{l+s+s1}{\PYZsq{}} \PY{o}{+}\PY{n+nb}{str}\PY{p}{(}\PY{n+nb}{round}\PY{p}{(}\PY{n}{variances}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,}\PY{l+m+mi}{7}\PY{p}{)}\PY{p}{)}\PY{o}{+}
                    \PY{l+s+s1}{\PYZsq{}}\PY{l+s+se}{\PYZbs{}n}\PY{l+s+s1}{ Cumm. Return: }\PY{l+s+s1}{\PYZsq{}}\PY{o}{+} \PY{n+nb}{str}\PY{p}{(}\PY{n+nb}{round}\PY{p}{(}\PY{n+nb}{sum}\PY{p}{(}\PY{n}{adapt\PYZus{}returns}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}\PY{p}{,}\PY{l+m+mi}{5}\PY{p}{)}\PY{p}{)}\PY{p}{)}
    \PY{n}{adapt\PYZus{}ret\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{adapt\PYZus{}returns}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{)}
    \PY{n}{adapt\PYZus{}ret\PYZus{}df}\PY{o}{.}\PY{n}{plot}\PY{o}{.}\PY{n}{kde}\PY{p}{(}\PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{twinx}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=} \PY{l+m+mf}{0.7}\PY{p}{,} \PY{n}{legend} \PY{o}{=} \PY{k+kc}{False}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
    
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_156_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    From all the portfolios analyzed until now, the adaptive time-varying
minimum variance portfolio with a time window of 22days performs best
with a cummulative return of 7.5\%. But the Variance increases. In
comparison to e.g.~the optimal weights portfolio with a variance of
0.000058.

Thus we see the impact of the weight updating in an increase of the
cummulative return. We could further improve our results with different
computations of the sample covariance matrix with giving older dates
less weight in comparison to newer ones. Like that we give newer events
more importance. Using more data will for sure also benefit the
portfolio.

    \hypertarget{robust-statistics-and-non-linear-methods}{%
\subsection{4 Robust Statistics and Non Linear
Methods}\label{robust-statistics-and-non-linear-methods}}

    \hypertarget{data-import-and-exploratory-data-analysis}{%
\subsubsection{4.1 Data Import and Exploratory Data
Analysis}\label{data-import-and-exploratory-data-analysis}}

    \hypertarget{section}{%
\paragraph{4.1.1}\label{section}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{342}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Read price data for AAPL, IBM, JPM and DJI.}
\PY{n}{stock\PYZus{}names} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AAPL}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{IBM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{JPM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{DJI}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} 
\PY{n}{AAPL} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AAPL.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{index\PYZus{}col} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)} 
\PY{n}{IBM} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{IBM.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{index\PYZus{}col} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}
\PY{n}{JPM} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{JPM.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{index\PYZus{}col} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}
\PY{n}{DJI} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{DJI.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{index\PYZus{}col} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}

\PY{n}{AAPL}\PY{o}{.}\PY{n}{index} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{to\PYZus{}datetime}\PY{p}{(}\PY{n}{AAPL}\PY{o}{.}\PY{n}{index}\PY{p}{)} 
\PY{n}{IBM}\PY{o}{.}\PY{n}{index} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{to\PYZus{}datetime}\PY{p}{(}\PY{n}{IBM}\PY{o}{.}\PY{n}{index}\PY{p}{)}
\PY{n}{JPM}\PY{o}{.}\PY{n}{index} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{to\PYZus{}datetime}\PY{p}{(}\PY{n}{JPM}\PY{o}{.}\PY{n}{index}\PY{p}{)}
\PY{n}{DJI}\PY{o}{.}\PY{n}{index} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{to\PYZus{}datetime}\PY{p}{(}\PY{n}{DJI}\PY{o}{.}\PY{n}{index}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{343}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{stats\PYZus{}df} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{index}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Median}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{StdDev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} 
                               \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Kurtosis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Skew}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{columns} \PY{o}{=} \PY{n}{AAPL}\PY{o}{.}\PY{n}{columns}\PY{p}{)}

\PY{n}{all\PYZus{}stocks} \PY{o}{=} \PY{p}{[}\PY{n}{AAPL}\PY{p}{,} \PY{n}{IBM}\PY{p}{,} \PY{n}{JPM}\PY{p}{,} \PY{n}{DJI}\PY{p}{]}
\PY{n}{statistics} \PY{o}{=} \PY{p}{\PYZob{}}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{AAPL}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{stats\PYZus{}df}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{IBM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{stats\PYZus{}df}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}\PY{p}{,}
              \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{JPM}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{stats\PYZus{}df}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{DJI}\PY{l+s+s1}{\PYZsq{}}\PY{p}{:} \PY{n}{stats\PYZus{}df}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)} \PY{p}{\PYZcb{}}

\PY{n}{i} \PY{o}{=} \PY{l+m+mi}{0}

\PY{k}{for} \PY{n}{stock} \PY{o+ow}{in} \PY{n}{all\PYZus{}stocks}\PY{p}{:}
    \PY{k}{for} \PY{n}{column} \PY{o+ow}{in} \PY{n}{stock}\PY{o}{.}\PY{n}{columns}\PY{p}{:}
        \PY{n}{statistics}\PY{p}{[}\PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{]}\PY{p}{[}\PY{n}{column}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{stock}\PY{p}{[}\PY{n}{column}\PY{p}{]}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
        \PY{n}{statistics}\PY{p}{[}\PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{]}\PY{p}{[}\PY{n}{column}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Median}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{stock}\PY{p}{[}\PY{n}{column}\PY{p}{]}\PY{o}{.}\PY{n}{median}\PY{p}{(}\PY{p}{)}
        \PY{n}{statistics}\PY{p}{[}\PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{]}\PY{p}{[}\PY{n}{column}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{StdDev}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{stock}\PY{p}{[}\PY{n}{column}\PY{p}{]}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}
        \PY{n}{statistics}\PY{p}{[}\PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{]}\PY{p}{[}\PY{n}{column}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Kurtosis}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{stock}\PY{p}{[}\PY{n}{column}\PY{p}{]}\PY{o}{.}\PY{n}{kurtosis}\PY{p}{(}\PY{p}{)}
        \PY{n}{statistics}\PY{p}{[}\PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{]}\PY{p}{[}\PY{n}{column}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Skew}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{stock}\PY{p}{[}\PY{n}{column}\PY{p}{]}\PY{o}{.}\PY{n}{skew}\PY{p}{(}\PY{p}{)}
    
    \PY{c+c1}{\PYZsh{} add the return as a column}
    \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{pct\PYZus{}change}\PY{p}{(}\PY{p}{)}
    
    \PY{n}{i} \PY{o}{=} \PY{n}{i}\PY{o}{+}\PY{l+m+mi}{1}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{344}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{AAPL}\PY{o}{.}\PY{n}{head}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{344}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
                  Open        High         Low       Close   Adj Close  \textbackslash{}
Date
2018-03-16  178.649994  179.119995  177.619995  178.020004  175.349915
2018-03-19  177.320007  177.470001  173.660004  175.300003  172.670731
2018-03-20  175.240005  176.800003  174.940002  175.240005  172.611618
2018-03-21  175.039993  175.089996  171.259995  171.270004  168.701157
2018-03-22  170.000000  172.679993  168.600006  168.850006  166.317459

              Volume    Return
Date
2018-03-16  39404700       NaN
2018-03-19  33446800 -0.015279
2018-03-20  19649400 -0.000342
2018-03-21  36338100 -0.022655
2018-03-22  41490800 -0.014130
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{345}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{statistics}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{DJI}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{345}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
                  Open          High           Low         Close  \textbackslash{}
Mean      25001.257268  25142.041965  24846.002226  24999.153581
Median    25025.580078  25124.099609  24883.039063  25044.289063
StdDev      858.834708    815.203959    903.302186    859.132105
Kurtosis      0.485736      0.118153      0.557592      0.400668
Skew         -0.372127     -0.239367     -0.456447     -0.380147

             Adj Close            Volume
Mean      24999.153581  332889442.231076
Median    25044.289063       313790000.0
StdDev      859.132105    94078038.14115
Kurtosis      0.400668          5.857581
Skew         -0.380147           1.73956
\end{Verbatim}
\end{tcolorbox}
        
    \hypertarget{section}{%
\paragraph{4.1.2}\label{section}}

    Bellow you find the histograms of the Returns and the Adj. Closure
prices of the stocks with a fitted curve resulting from Kernel Density
Estimation (KDE). This KDE is done with the \texttt{DataFrame.plot.kde}
function.

We see that the returns are distributed nearly gaussian normal, while
the Adj. Closure prices need some more difficult gaussian fitting. This
reflects what we saw in section 1, that returns tend to be normal
distributed. There is a mentionable difference between the Adj. Closure
prices of AAPL and IBM in comparison to JPM and DJI. DJI and JPM seem to
have more stable Adj. Closure prices and have a smaller variance. This
could be the case, since the banking sector is not as volatile as the
tech sector, and since DJI is an index and indexes tend to have lower
volatility because of diversification.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{346}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Histogram and Probability Density Function ff the Adj. Close and 1\PYZhy{}day Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=} \PY{l+m+mi}{15}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{13}\PY{p}{,}\PY{l+m+mi}{6}\PY{p}{)}

\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{stock} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{all\PYZus{}stocks}\PY{p}{)}\PY{p}{:}
    \PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{hist}\PY{p}{(}\PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{bins} \PY{o}{=} \PY{l+m+mi}{40}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{hist}\PY{p}{(}\PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{,} \PY{n}{bins} \PY{o}{=} \PY{l+m+mi}{40}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ Adj. Closure}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Return }\PY{l+s+s1}{\PYZpc{}}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj. Closure Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
    \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{o}{.}\PY{n}{kde}\PY{p}{(}\PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{twinx}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{o}{.}\PY{n}{kde}\PY{p}{(}\PY{n}{ax}\PY{o}{=}\PY{n}{ax}\PY{p}{[}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{twinx}\PY{p}{(}\PY{p}{)}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    
\PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}    
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_167_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{section}{%
\paragraph{4.1.3}\label{section}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{347}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj. Closure with Rolling Mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=} \PY{l+m+mi}{15}\PY{p}{)}

\PY{n}{fig2}\PY{p}{,} \PY{n}{ax2} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig2}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}
\PY{n}{fig2}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj. Closure with Rolling Median}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=} \PY{l+m+mi}{15}\PY{p}{)}

\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{stock} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{all\PYZus{}stocks}\PY{p}{)}\PY{p}{:}
    \PY{k}{if} \PY{n}{i} \PY{o}{\PYZgt{}} \PY{l+m+mi}{1}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{1}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{0}
    
    \PY{n}{stock\PYZus{}rolling\PYZus{}mean} \PY{o}{=} \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
    \PY{n}{stock\PYZus{}rolling\PYZus{}median} \PY{o}{=} \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}\PY{o}{.}\PY{n}{median}\PY{p}{(}\PY{p}{)}
    \PY{n}{stock\PYZus{}rolling\PYZus{}std} \PY{o}{=} \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}
    \PY{n}{stock\PYZus{}rolling\PYZus{}mad} \PY{o}{=} \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{n}{mad}\PY{p}{)}
    \PY{n}{upper\PYZus{}bound\PYZus{}mean} \PY{o}{=} \PY{n}{stock\PYZus{}rolling\PYZus{}mean} \PY{o}{+} \PY{l+m+mf}{1.5}\PY{o}{*} \PY{n}{stock\PYZus{}rolling\PYZus{}std}
    \PY{n}{lower\PYZus{}bound\PYZus{}mean} \PY{o}{=} \PY{n}{stock\PYZus{}rolling\PYZus{}mean} \PY{o}{\PYZhy{}} \PY{l+m+mf}{1.5}\PY{o}{*} \PY{n}{stock\PYZus{}rolling\PYZus{}std}
    \PY{n}{upper\PYZus{}bound\PYZus{}median} \PY{o}{=} \PY{n}{stock\PYZus{}rolling\PYZus{}median} \PY{o}{+} \PY{l+m+mf}{1.5}\PY{o}{*} \PY{n}{stock\PYZus{}rolling\PYZus{}mad}
    \PY{n}{lower\PYZus{}bound\PYZus{}median} \PY{o}{=} \PY{n}{stock\PYZus{}rolling\PYZus{}median} \PY{o}{\PYZhy{}} \PY{l+m+mf}{1.5}\PY{o}{*} \PY{n}{stock\PYZus{}rolling\PYZus{}mad}


    \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{ax} \PY{o}{=} \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}], grid = True, 
                            \PY{n}{title} \PY{o}{=} \PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{ylabel}\PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(stock\PYZus{}rolling\PYZus{}mean, alpha = 0.6, color =\PYZsq{}r\PYZsq{})
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(upper\PYZus{}bound\PYZus{}mean, alpha = 0.6, color =\PYZsq{}purple\PYZsq{}, linewidth=0.5)
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(lower\PYZus{}bound\PYZus{}mean, alpha = 0.6, color =\PYZsq{}purple\PYZsq{}, linewidth=0.5)
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].fill\PYZus{}between(stock\PYZus{}rolling\PYZus{}mean.index, upper\PYZus{}bound\PYZus{}mean, 
                            \PY{n}{lower\PYZus{}bound\PYZus{}mean}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.1}\PY{p}{)}
    
    \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{ax} \PY{o}{=} \PY{n}{ax2}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}], grid = True, 
                            \PY{n}{title} \PY{o}{=} \PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{ylabel}\PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{)}
    \PY{n}{ax2}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(stock\PYZus{}rolling\PYZus{}median, alpha = 0.6, color =\PYZsq{}r\PYZsq{})
    \PY{n}{ax2}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(upper\PYZus{}bound\PYZus{}median, alpha = 0.6, color =\PYZsq{}purple\PYZsq{}, linewidth=0.5)
    \PY{n}{ax2}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(lower\PYZus{}bound\PYZus{}median, alpha = 0.6, color =\PYZsq{}purple\PYZsq{}, linewidth=0.5)
    \PY{n}{ax2}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].fill\PYZus{}between(stock\PYZus{}rolling\PYZus{}median.index, upper\PYZus{}bound\PYZus{}median, 
                            \PY{n}{lower\PYZus{}bound\PYZus{}median}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.1}\PY{p}{)}
    
    
\PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}    
\PY{n}{fig2}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}   
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_169_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_169_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Observations: The bounds computed with the mean are often times not as
strict as the ones calculated with the median and are also smoother. The
Median Bounds have many more spikes n comparison to the mean.

    \hypertarget{section}{%
\paragraph{4.1.4}\label{section}}

    Now we introduce outlier points into our data.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{427}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{outlier\PYZus{}dates} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2018\PYZhy{}05\PYZhy{}14}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2018\PYZhy{}09\PYZhy{}14}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2018\PYZhy{}12\PYZhy{}14}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2019\PYZhy{}01\PYZhy{}14}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}

\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj. Closure with Rolling Mean}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=} \PY{l+m+mi}{15}\PY{p}{)}

\PY{n}{fig2}\PY{p}{,} \PY{n}{ax2} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig2}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}
\PY{n}{fig2}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj. Closure with Rolling Median}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=} \PY{l+m+mi}{15}\PY{p}{)}

\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{stock} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{all\PYZus{}stocks}\PY{p}{)}\PY{p}{:}
    \PY{k}{if} \PY{n}{i} \PY{o}{\PYZgt{}} \PY{l+m+mi}{1}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{1}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{0}
        
    \PY{n}{stock\PYZus{}modified} \PY{o}{=} \PY{n}{stock}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
    \PY{n}{outliers\PYZus{}value} \PY{o}{=} \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}\PY{o}{*}\PY{l+m+mf}{1.2}
    
    \PY{k}{for} \PY{n}{date} \PY{o+ow}{in} \PY{n}{outlier\PYZus{}dates}\PY{p}{:}
        \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{n}{date}\PY{p}{]} \PY{o}{=} \PY{n}{outliers\PYZus{}value}
    
    \PY{n}{stock\PYZus{}rolling\PYZus{}mean} \PY{o}{=} \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
    \PY{n}{stock\PYZus{}rolling\PYZus{}median} \PY{o}{=} \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}\PY{o}{.}\PY{n}{median}\PY{p}{(}\PY{p}{)}
    \PY{n}{stock\PYZus{}rolling\PYZus{}std} \PY{o}{=} \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}\PY{o}{.}\PY{n}{std}\PY{p}{(}\PY{p}{)}
    \PY{n}{stock\PYZus{}rolling\PYZus{}mad} \PY{o}{=} \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{5}\PY{p}{)}\PY{o}{.}\PY{n}{apply}\PY{p}{(}\PY{n}{mad}\PY{p}{)}
    \PY{n}{upper\PYZus{}bound\PYZus{}mean} \PY{o}{=} \PY{n}{stock\PYZus{}rolling\PYZus{}mean} \PY{o}{+} \PY{l+m+mf}{1.5}\PY{o}{*} \PY{n}{stock\PYZus{}rolling\PYZus{}std}
    \PY{n}{lower\PYZus{}bound\PYZus{}mean} \PY{o}{=} \PY{n}{stock\PYZus{}rolling\PYZus{}mean} \PY{o}{\PYZhy{}} \PY{l+m+mf}{1.5}\PY{o}{*} \PY{n}{stock\PYZus{}rolling\PYZus{}std}
    \PY{n}{upper\PYZus{}bound\PYZus{}median} \PY{o}{=} \PY{n}{stock\PYZus{}rolling\PYZus{}median} \PY{o}{+} \PY{l+m+mf}{1.5}\PY{o}{*} \PY{n}{stock\PYZus{}rolling\PYZus{}mad}
    \PY{n}{lower\PYZus{}bound\PYZus{}median} \PY{o}{=} \PY{n}{stock\PYZus{}rolling\PYZus{}median} \PY{o}{\PYZhy{}} \PY{l+m+mf}{1.5}\PY{o}{*} \PY{n}{stock\PYZus{}rolling\PYZus{}mad}


    \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{ax} \PY{o}{=} \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}], grid = True, 
                            \PY{n}{title} \PY{o}{=} \PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{ylabel}\PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(stock\PYZus{}rolling\PYZus{}mean, alpha = 0.6, color =\PYZsq{}r\PYZsq{})
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(upper\PYZus{}bound\PYZus{}mean, alpha = 0.6, color =\PYZsq{}purple\PYZsq{}, linewidth=0.5)
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(lower\PYZus{}bound\PYZus{}mean, alpha = 0.6, color =\PYZsq{}purple\PYZsq{}, linewidth=0.5)
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].fill\PYZus{}between(stock\PYZus{}rolling\PYZus{}mean.index, upper\PYZus{}bound\PYZus{}mean, 
                            \PY{n}{lower\PYZus{}bound\PYZus{}mean}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.1}\PY{p}{)}
    
    \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{ax} \PY{o}{=} \PY{n}{ax2}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}], grid = True, 
                            \PY{n}{title} \PY{o}{=} \PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{ylabel}\PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{)}
    \PY{n}{ax2}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(stock\PYZus{}rolling\PYZus{}median, alpha = 0.6, color =\PYZsq{}r\PYZsq{})
    \PY{n}{ax2}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(upper\PYZus{}bound\PYZus{}median, alpha = 0.6, color =\PYZsq{}purple\PYZsq{}, linewidth=0.5)
    \PY{n}{ax2}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(lower\PYZus{}bound\PYZus{}median, alpha = 0.6, color =\PYZsq{}purple\PYZsq{}, linewidth=0.5)
    \PY{n}{ax2}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].fill\PYZus{}between(stock\PYZus{}rolling\PYZus{}median.index, upper\PYZus{}bound\PYZus{}median, 
                            \PY{n}{lower\PYZus{}bound\PYZus{}median}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.1}\PY{p}{)}
    
    
\PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}    
\PY{n}{fig2}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}   
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_173_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_173_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    We see that the rolling median bounds work better, since they don't
respond to the added outliers. On the other hand the rolling mean tries
to include the outliers in the upper and lower bounds and therefore we
get the big surfaces next to the outliers. Therefore we conclude that
for this scenario the median is more robust to outlier detection than
the mean.

    \hypertarget{section}{%
\paragraph{4.1.5}\label{section}}

    In a box plot the minimum, first quartile, median, third quartile and
maximum are depicted. The box extends from the lower to upper quartile
values of the data. The orange line is at the median. The whiskers that
extend from the box are showing the range of the data. Outlier points
are those past the end of the whiskers depicted by a circle.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{364}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig}\PY{p}{,} \PY{n}{axes} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,} \PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{4}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}

\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{stock} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{all\PYZus{}stocks}\PY{p}{)}\PY{p}{:}
    \PY{k}{if} \PY{n}{i} \PY{o}{\PYZgt{}} \PY{l+m+mi}{1}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{1}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{0}
    \PY{n}{axes}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].boxplot(stock[\PYZsq{}Adj Close\PYZsq{}], vert=False, )
    \PY{n}{axes}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].set\PYZus{}title(\PYZsq{}Box Plot \PYZsq{} + stock\PYZus{}names[i])
    \PY{n}{axes}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].grid()
    \PY{n}{axes}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].set\PYZus{}xlabel(\PYZsq{}Price\PYZsq{})

\PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_177_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    We see that AAPL has the largest upper to lower quartile values
therefore having the highest volatility. We also see that the median of
IBM is strongly skewed towards the upper quartile.

    \hypertarget{robust-estimators}{%
\subsubsection{4.2 Robust Estimators}\label{robust-estimators}}

    This section involves the implementation, analysis and assessment of the
following estimators:

• Robust location estimator: median

• Robust scale estimator: IQR (Interquartile range) and MAD (Median
Absolute Deviation)

    \hypertarget{section}{%
\paragraph{4.2.1}\label{section}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{367}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{def} \PY{n+nf}{robust\PYZus{}location\PYZus{}estimator\PYZus{}median}\PY{p}{(}\PY{n}{data}\PY{p}{)}\PY{p}{:}
    \PY{n}{data} \PY{o}{=} \PY{n}{data}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{p}{)}
    \PY{k}{return} \PY{n}{data}\PY{p}{[}\PY{n+nb}{round}\PY{p}{(}\PY{n}{data}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{p}{)}\PY{o}{/}\PY{l+m+mi}{2}\PY{p}{)}\PY{p}{]}
    
\PY{k}{def} \PY{n+nf}{robust\PYZus{}scale\PYZus{}estimator\PYZus{}iqr}\PY{p}{(}\PY{n}{data}\PY{p}{)}\PY{p}{:}
    \PY{n}{data} \PY{o}{=} \PY{n}{data}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{p}{)}
    \PY{k}{return} \PY{n}{data}\PY{p}{[}\PY{n+nb}{round}\PY{p}{(}\PY{n}{data}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{p}{)}\PY{o}{/}\PY{l+m+mi}{4}\PY{o}{*}\PY{l+m+mi}{3}\PY{p}{)}\PY{p}{]} \PY{o}{\PYZhy{}} \PY{n}{data}\PY{p}{[}\PY{n+nb}{round}\PY{p}{(}\PY{n}{data}\PY{o}{.}\PY{n}{size}\PY{p}{(}\PY{p}{)}\PY{o}{/}\PY{l+m+mi}{7}\PY{p}{)}\PY{p}{]}
        
\PY{k}{def} \PY{n+nf}{robust\PYZus{}scale\PYZus{}estimator\PYZus{}mad}\PY{p}{(}\PY{n}{data}\PY{p}{)}\PY{p}{:}
    \PY{n}{median} \PY{o}{=} \PY{n}{robust\PYZus{}location\PYZus{}estimator\PYZus{}median}\PY{p}{(}\PY{n}{data}\PY{p}{)}
    \PY{k}{return} \PY{n}{robust\PYZus{}location\PYZus{}estimator\PYZus{}median}\PY{p}{(}\PY{n+nb}{abs}\PY{p}{(}\PY{n}{data} \PY{o}{\PYZhy{}} \PY{n}{median}\PY{p}{)}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \hypertarget{section}{%
\paragraph{4.2.2}\label{section}}

    Since pandas uses quicksort as default sorting algorithm for
\texttt{sort\_values()} we have a Best-case performane of \(O(nlogn)\)
and worst case of \(O(n^2)\) for the sorting part.

Thus we get the following complexities:

\(\textbf{Median}\): Since the median lookup only needs \(O(1)\) the
function \texttt{robust\_location\_estimator\_median} has the following
running time complexities:

best case of \(O(nlog(n)+1) = O(nlog(n))\) as \$ n \rightarrow ∞ \$

worst case of \(O(n^2+1) = O(n^2)\) as \$ n \rightarrow ∞ \$

\(\textbf{IQR}\): Since the IQR lookup only needs two lookups
i.e.~\(O(1)\) the function \texttt{robust\_scale\_estimator\_iqr} has
the following running time complexities:

best case of \(O(nlog(n)+1) = O(nlog(n))\) as \$ n \rightarrow ∞ \$

worst case of \(O(n^2+1) = O(n^2)\) as \$ n \rightarrow ∞ \$

\(\textbf{MAD}\): Here we have to calculate the median two times and
also get an added complexity of \(O(n)\) because for each datapoint in
\texttt{data} we have to calculate a subtraction. Therefore the function
\texttt{robust\_scale\_estimator\_mad} has the following running time
complexities:

best case of \(O(2* nlog(n) + n) = O(nlog(n))\) as \$ n \rightarrow ∞ \$

worst case of \(O(2* n^2+n+1) = O(n^2)\) as \$ n \rightarrow ∞ \$

    \hypertarget{section}{%
\paragraph{4.2.3}\label{section}}

    As defined in the lecture: ``Maximum allowed fraction of outliers that
an estimator can tolerate'', we analyze the breakdown point of the above
algorithms. For the median estimator we can conclude that having n data
points and changing just the upper or lower half of the points won't
change the median. Formally speaking this means that our breakdown point
is at 0.5 since: \[ \lim_{n \to ∞}\frac{0.5 n-1}{n} = 0.5 \]

Since \$ 0.5n-1 \$ is the amount of point we are allowed to change.

For the IQR we can simplify the poblem to having split the data in two
parts and taking the median of each part. Therefore we get a breaking
point of 0.25 according to the reasoning above.

For the MAD we get the same breakdown point as for the median, since we
take the median and then we calculate the absolute deviation from the
median and since the median has a breakdown point of 0.5, we get also a
breakdown point of 0.5 for MAD.

    \hypertarget{robust-and-ols-regression}{%
\subsubsection{4.3 Robust and OLS
Regression}\label{robust-and-ols-regression}}

    \hypertarget{section}{%
\paragraph{4.3.1}\label{section}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{410}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} we only want returns}
\PY{n}{returns} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{columns} \PY{o}{=} \PY{n}{stock\PYZus{}names}\PY{p}{)}

\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{stock} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{all\PYZus{}stocks}\PY{p}{)}\PY{p}{:}
    \PY{n}{returns}\PY{p}{[}\PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{]} \PY{o}{=} \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}
    
\PY{n}{regression\PYZus{}model\PYZus{}ols} \PY{o}{=} \PY{n}{linear\PYZus{}model}\PY{o}{.}\PY{n}{LinearRegression}\PY{p}{(}\PY{p}{)}
\PY{n}{regressed\PYZus{}values} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{n}{stock\PYZus{}names}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{alpha}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{beta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mse}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}

\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{6}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}

\PY{n}{x} \PY{o}{=} \PY{n}{returns}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{DJI}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{values}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}

\PY{k}{for} \PY{n}{i}\PY{p}{,}\PY{n}{stock} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{:}
    \PY{n}{y} \PY{o}{=} \PY{n}{returns}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{values}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
    \PY{n}{regression\PYZus{}model\PYZus{}ols}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{y}\PY{p}{)}
    \PY{n}{regressed\PYZus{}values}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{alpha}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{regression\PYZus{}model\PYZus{}ols}\PY{o}{.}\PY{n}{intercept\PYZus{}}\PY{p}{)}
    \PY{n}{regressed\PYZus{}values}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{beta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{regression\PYZus{}model\PYZus{}ols}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{p}{)}

    \PY{n}{pred} \PY{o}{=} \PY{n}{regression\PYZus{}model\PYZus{}ols}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{x}\PY{p}{)}
    \PY{n}{regressed\PYZus{}values}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mse}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{mean\PYZus{}squared\PYZus{}error}\PY{p}{(}\PY{n}{y}\PY{p}{,} \PY{n}{pred}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{returns}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{y}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{returns}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{pred}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Prediction}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{n}{stock} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ OLS Returns Prediction}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
    
    
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_189_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \hypertarget{section}{%
\paragraph{4.3.2}\label{section}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{411}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{regression\PYZus{}model\PYZus{}hub} \PY{o}{=} \PY{n}{linear\PYZus{}model}\PY{o}{.}\PY{n}{HuberRegressor}\PY{p}{(}\PY{n}{epsilon}\PY{o}{=}\PY{l+m+mf}{1.0}\PY{p}{)}
\PY{n}{regressed\PYZus{}values\PYZus{}hub} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{n}{stock\PYZus{}names}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{alpha}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{beta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mse}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}

\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{9}\PY{p}{,}\PY{l+m+mi}{6}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}

\PY{n}{x} \PY{o}{=} \PY{n}{returns}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{DJI}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{values}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}

\PY{k}{for} \PY{n}{i}\PY{p}{,}\PY{n}{stock} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{:}
    \PY{n}{y} \PY{o}{=} \PY{n}{returns}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{values}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
    \PY{n}{regression\PYZus{}model\PYZus{}hub}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{y}\PY{p}{)}
    \PY{n}{regressed\PYZus{}values\PYZus{}hub}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{alpha}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{regression\PYZus{}model\PYZus{}hub}\PY{o}{.}\PY{n}{intercept\PYZus{}}\PY{p}{)}
    \PY{n}{regressed\PYZus{}values\PYZus{}hub}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{beta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{regression\PYZus{}model\PYZus{}hub}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{p}{)}

    \PY{n}{pred} \PY{o}{=} \PY{n}{regression\PYZus{}model\PYZus{}hub}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{x}\PY{p}{)}
    \PY{n}{regressed\PYZus{}values\PYZus{}hub}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mse}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{mean\PYZus{}squared\PYZus{}error}\PY{p}{(}\PY{n}{y}\PY{p}{,} \PY{n}{pred}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{returns}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{y}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{returns}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{pred}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Prediction}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{n}{stock} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ OLS Returns Prediction}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_191_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{422}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{regressed\PYZus{}values}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{422}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
           AAPL       IBM       JPM  DJI
alpha  0.000165 -0.000441 -0.000316  NaN
beta    1.32558  0.960092  0.931408  NaN
mse     0.00018   0.00014  0.000076  NaN
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{423}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{regressed\PYZus{}values\PYZus{}hub}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{423}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
           AAPL       IBM       JPM  DJI
alpha -0.000149 -0.000628 -0.000485  NaN
beta   1.297928  1.012351  0.909187  NaN
mse     0.00018  0.000141  0.000076  NaN
\end{Verbatim}
\end{tcolorbox}
        
    \hypertarget{section}{%
\paragraph{4.3.3}\label{section}}

    For the outlier comparison we take again the data from before where we
introduced 4 outliers. We predict the returns with both models.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{447}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{returns} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{columns} \PY{o}{=} \PY{n}{stock\PYZus{}names}\PY{p}{)}
\PY{n}{regressed\PYZus{}values\PYZus{}ols} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{n}{stock\PYZus{}names}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{alpha}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{beta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mse}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
\PY{n}{regressed\PYZus{}values\PYZus{}hub} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{n}{stock\PYZus{}names}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{alpha}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{beta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mse}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}

\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{stock} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{all\PYZus{}stocks}\PY{p}{)}\PY{p}{:}
    \PY{n}{stock\PYZus{}modified} \PY{o}{=} \PY{n}{stock}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
    
    \PY{n}{outliers\PYZus{}value\PYZus{}ret} \PY{o}{=} \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}\PY{o}{*}\PY{l+m+mf}{1.2}
    
    \PY{k}{for} \PY{n}{date} \PY{o+ow}{in} \PY{n}{outlier\PYZus{}dates}\PY{p}{:}
        \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{n}{date}\PY{p}{]} \PY{o}{=} \PY{n}{outliers\PYZus{}value\PYZus{}ret}
    
    \PY{n}{returns}\PY{p}{[}\PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{]} \PY{o}{=} \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}

\PY{c+c1}{\PYZsh{} models}
\PY{n}{regression\PYZus{}model\PYZus{}ols} \PY{o}{=} \PY{n}{linear\PYZus{}model}\PY{o}{.}\PY{n}{LinearRegression}\PY{p}{(}\PY{p}{)}
\PY{n}{regressed\PYZus{}values\PYZus{}ols} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{n}{stock\PYZus{}names}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{alpha}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{beta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mse}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
\PY{n}{regression\PYZus{}model\PYZus{}hub} \PY{o}{=} \PY{n}{linear\PYZus{}model}\PY{o}{.}\PY{n}{HuberRegressor}\PY{p}{(}\PY{n}{epsilon}\PY{o}{=}\PY{l+m+mf}{1.0}\PY{p}{)}
\PY{n}{regressed\PYZus{}values\PYZus{}hub} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{DataFrame}\PY{p}{(}\PY{n}{columns}\PY{o}{=}\PY{n}{stock\PYZus{}names}\PY{p}{,} \PY{n}{index}\PY{o}{=}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{alpha}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{beta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mse}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}

\PY{c+c1}{\PYZsh{} plot}
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{3}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{12}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}

\PY{n}{x} \PY{o}{=} \PY{n}{returns}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{DJI}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{values}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}

\PY{k}{for} \PY{n}{i}\PY{p}{,}\PY{n}{stock} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{:}
    \PY{n}{y} \PY{o}{=} \PY{n}{returns}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{values}\PY{o}{.}\PY{n}{reshape}\PY{p}{(}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{,}\PY{l+m+mi}{1}\PY{p}{)}
    
    \PY{n}{regression\PYZus{}model\PYZus{}ols}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{y}\PY{p}{)}
    \PY{n}{regressed\PYZus{}values\PYZus{}ols}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{alpha}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{regression\PYZus{}model\PYZus{}ols}\PY{o}{.}\PY{n}{intercept\PYZus{}}\PY{p}{)}
    \PY{n}{regressed\PYZus{}values\PYZus{}ols}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{beta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{regression\PYZus{}model\PYZus{}ols}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{p}{)}
    
    \PY{n}{regression\PYZus{}model\PYZus{}hub}\PY{o}{.}\PY{n}{fit}\PY{p}{(}\PY{n}{x}\PY{p}{,} \PY{n}{y}\PY{p}{)}
    \PY{n}{regressed\PYZus{}values\PYZus{}hub}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{alpha}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{regression\PYZus{}model\PYZus{}hub}\PY{o}{.}\PY{n}{intercept\PYZus{}}\PY{p}{)}
    \PY{n}{regressed\PYZus{}values\PYZus{}hub}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{beta}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n+nb}{float}\PY{p}{(}\PY{n}{regression\PYZus{}model\PYZus{}hub}\PY{o}{.}\PY{n}{coef\PYZus{}}\PY{p}{)}

    \PY{n}{pred\PYZus{}ols} \PY{o}{=} \PY{n}{regression\PYZus{}model\PYZus{}ols}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{x}\PY{p}{)}
    \PY{n}{pred\PYZus{}hub} \PY{o}{=} \PY{n}{regression\PYZus{}model\PYZus{}hub}\PY{o}{.}\PY{n}{predict}\PY{p}{(}\PY{n}{x}\PY{p}{)}
    \PY{n}{regressed\PYZus{}values\PYZus{}ols}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mse}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{mean\PYZus{}squared\PYZus{}error}\PY{p}{(}\PY{n}{y}\PY{p}{,} \PY{n}{pred\PYZus{}ols}\PY{p}{)}
    \PY{n}{regressed\PYZus{}values\PYZus{}hub}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{mse}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{=} \PY{n}{mean\PYZus{}squared\PYZus{}error}\PY{p}{(}\PY{n}{y}\PY{p}{,} \PY{n}{pred\PYZus{}hub}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{returns}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{y}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{returns}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{pred\PYZus{}ols}\PY{p}{,} \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.6}\PY{p}{,} \PY{n}{linewidth} \PY{o}{=} \PY{l+m+mi}{1}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{returns}\PY{p}{[}\PY{n}{stock}\PY{p}{]}\PY{o}{.}\PY{n}{index}\PY{p}{,} \PY{n}{pred\PYZus{}hub}\PY{p}{,} \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.6}\PY{p}{,} \PY{n}{color} \PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{linewidth} \PY{o}{=} \PY{l+m+mi}{1}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Data}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Prediction OLS}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Prediction Huber}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}title}\PY{p}{(}\PY{n}{stock} \PY{o}{+} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{ Returns Prediction with Outliers}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{set\PYZus{}ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Returns}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_196_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{450}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{regressed\PYZus{}values\PYZus{}ols}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{450}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
           AAPL       IBM       JPM  DJI
alpha   0.00035 -0.000063 -0.000467  NaN
beta   1.350465   1.22204  0.906468  NaN
mse    0.000179   0.00016  0.000075  NaN
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{449}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{regressed\PYZus{}values\PYZus{}hub}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{449}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
           AAPL       IBM       JPM  DJI
alpha  0.000066 -0.000602 -0.000631  NaN
beta   1.411455  1.070155  0.844397  NaN
mse    0.000179  0.000164  0.000076  NaN
\end{Verbatim}
\end{tcolorbox}
        
    We can see that the alphas and betas are pretty different, but the MSE
is simillar. The models are predicting the outliers reliably, but the
OLS regressor often overestimates the outlier whereas the Huber
regressor predicts it more robustly.

    \hypertarget{robust-trading-strategies}{%
\subsubsection{4.4 Robust Trading
Strategies}\label{robust-trading-strategies}}

    \hypertarget{section}{%
\paragraph{4.4.1}\label{section}}

    Bellow you find the plots of the return including the 20 day and 50 day
moving averages. The first plot is without outliers and the second
includes some artificial outliers.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{493}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj. Closure Moving Average}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=} \PY{l+m+mi}{15}\PY{p}{)}

\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{stock} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{all\PYZus{}stocks}\PY{p}{)}\PY{p}{:}
    \PY{k}{if} \PY{n}{i} \PY{o}{\PYZgt{}} \PY{l+m+mi}{1}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{1}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{0}
    
    \PY{n}{stock\PYZus{}rolling\PYZus{}20} \PY{o}{=} \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
    \PY{n}{stock\PYZus{}rolling\PYZus{}50} \PY{o}{=} \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{50}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
    \PY{n}{stock\PYZus{}buying}\PY{o}{.}\PY{n}{index} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{to\PYZus{}datetime}\PY{p}{(}\PY{n}{stock\PYZus{}rolling\PYZus{}20}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{l+m+mi}{49}\PY{p}{:}\PY{p}{]}\PY{p}{)}
    \PY{n}{stock\PYZus{}buying} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sign}\PY{p}{(}\PY{p}{(}\PY{n}{stock\PYZus{}rolling\PYZus{}20} \PY{o}{\PYZhy{}} \PY{n}{stock\PYZus{}rolling\PYZus{}50}\PY{p}{)}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}\PY{p}{)}

    \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{49}\PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{ax} \PY{o}{=} \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}], grid = True, 
                            \PY{n}{title} \PY{o}{=} \PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{ylabel}\PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(stock\PYZus{}rolling\PYZus{}20[49:], alpha = 0.6, color =\PYZsq{}r\PYZsq{}, linewidth=0.5, label=\PYZsq{}MA 20\PYZsq{})
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(stock\PYZus{}rolling\PYZus{}50, alpha = 0.6, color =\PYZsq{}purple\PYZsq{}, linewidth=0.5, label=\PYZsq{}MA 50\PYZsq{})
    \PY{n}{sign\PYZus{}before} \PY{o}{=} \PY{n}{stock\PYZus{}buying}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
    
    \PY{k}{for} \PY{n}{z}\PY{p}{,} \PY{n}{value} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{stock\PYZus{}buying}\PY{p}{[}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{:}
        \PY{k}{if} \PY{n}{value} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{:}
            \PY{k}{if} \PY{n}{sign\PYZus{}before} \PY{o}{==} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{:}
                \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].axvline(stock\PYZus{}buying.index[z], linestyle = \PYZsq{}\PYZhy{}\PYZhy{}\PYZsq{}, linewidth = 1, 
                                   \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Buy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{sign\PYZus{}before} \PY{o}{=} \PY{l+m+mi}{1}
            \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].axvspan(stock\PYZus{}buying.index[z], stock\PYZus{}buying.index[z+1], 
                               \PY{n}{facecolor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.2}\PY{p}{)}
        \PY{k}{else}\PY{p}{:}
            \PY{k}{if} \PY{n}{sign\PYZus{}before} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{:}
                \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].axvline(stock\PYZus{}buying.index[z], linestyle = \PYZsq{}\PYZhy{}\PYZhy{}\PYZsq{}, linewidth = 1, 
                                   \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{red}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Sell}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{sign\PYZus{}before} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}
            \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].axvspan(stock\PYZus{}buying.index[z], stock\PYZus{}buying.index[z+1], 
                               \PY{n}{facecolor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.2}\PY{p}{)}

    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].legend([\PYZsq{}Price\PYZsq{},\PYZsq{}MA 20\PYZsq{},\PYZsq{}MA 50\PYZsq{},\PYZsq{}Buy\PYZsq{},\PYZsq{}Sell\PYZsq{}], loc=\PYZsq{}lower left\PYZsq{})

\PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}    
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_203_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{509}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj. Closure Moving Average With Outliers}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=} \PY{l+m+mi}{15}\PY{p}{)}
\PY{n}{outlier\PYZus{}dates} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2018\PYZhy{}07\PYZhy{}27}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2018\PYZhy{}09\PYZhy{}14}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2018\PYZhy{}11\PYZhy{}5}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2018\PYZhy{}12\PYZhy{}14}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2019\PYZhy{}01\PYZhy{}14}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}

\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{stock} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{all\PYZus{}stocks}\PY{p}{)}\PY{p}{:}
    \PY{k}{if} \PY{n}{i} \PY{o}{\PYZgt{}} \PY{l+m+mi}{1}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{1}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{0}
        
    \PY{n}{stock\PYZus{}modified} \PY{o}{=} \PY{n}{stock}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
    \PY{n}{outliers\PYZus{}value\PYZus{}max} \PY{o}{=} \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}
    \PY{n}{outliers\PYZus{}value\PYZus{}min} \PY{o}{=} \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{p}{)}
    
    \PY{k}{for} \PY{n}{counter}\PY{p}{,} \PY{n}{date} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{outlier\PYZus{}dates}\PY{p}{)}\PY{p}{:}
        \PY{k}{if} \PY{n}{counter}\PY{o}{\PYZpc{}}\PY{k}{2} == 1:
            \PY{n}{current\PYZus{}value} \PY{o}{=} \PY{n}{outliers\PYZus{}value\PYZus{}max}\PY{o}{*}\PY{l+m+mf}{1.2}
        \PY{k}{else}\PY{p}{:}
            \PY{n}{current\PYZus{}value} \PY{o}{=} \PY{n}{outliers\PYZus{}value\PYZus{}min}\PY{o}{*}\PY{l+m+mf}{0.8}
            
        \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{n}{date}\PY{p}{]} \PY{o}{=} \PY{n}{current\PYZus{}value}
    
    \PY{n}{stock\PYZus{}rolling\PYZus{}20} \PY{o}{=} \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
    \PY{n}{stock\PYZus{}rolling\PYZus{}50} \PY{o}{=} \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{50}\PY{p}{)}\PY{o}{.}\PY{n}{mean}\PY{p}{(}\PY{p}{)}
    \PY{n}{stock\PYZus{}buying}\PY{o}{.}\PY{n}{index} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{to\PYZus{}datetime}\PY{p}{(}\PY{n}{stock\PYZus{}rolling\PYZus{}20}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{l+m+mi}{49}\PY{p}{:}\PY{p}{]}\PY{p}{)}
    \PY{n}{stock\PYZus{}buying} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sign}\PY{p}{(}\PY{p}{(}\PY{n}{stock\PYZus{}rolling\PYZus{}20} \PY{o}{\PYZhy{}} \PY{n}{stock\PYZus{}rolling\PYZus{}50}\PY{p}{)}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}\PY{p}{)}

    \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{49}\PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{ax} \PY{o}{=} \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}], grid = True, 
                            \PY{n}{title} \PY{o}{=} \PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{ylabel}\PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(stock\PYZus{}rolling\PYZus{}20[49:], alpha = 0.6, color =\PYZsq{}r\PYZsq{}, linewidth=0.5, label=\PYZsq{}MA 20\PYZsq{})
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(stock\PYZus{}rolling\PYZus{}50, alpha = 0.6, color =\PYZsq{}purple\PYZsq{}, linewidth=0.5, label=\PYZsq{}MA 50\PYZsq{})
    \PY{n}{sign\PYZus{}before} \PY{o}{=} \PY{n}{stock\PYZus{}buying}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
    
    \PY{k}{for} \PY{n}{z}\PY{p}{,} \PY{n}{value} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{stock\PYZus{}buying}\PY{p}{[}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{:}
        \PY{k}{if} \PY{n}{value} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{:}
            \PY{k}{if} \PY{n}{sign\PYZus{}before} \PY{o}{==} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{:}
                \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].axvline(stock\PYZus{}buying.index[z], linestyle = \PYZsq{}\PYZhy{}\PYZhy{}\PYZsq{}, linewidth = 1, 
                                   \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Buy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{sign\PYZus{}before} \PY{o}{=} \PY{l+m+mi}{1}
            \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].axvspan(stock\PYZus{}buying.index[z], stock\PYZus{}buying.index[z+1], 
                               \PY{n}{facecolor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.2}\PY{p}{)}
        \PY{k}{else}\PY{p}{:}
            \PY{k}{if} \PY{n}{sign\PYZus{}before} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{:}
                \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].axvline(stock\PYZus{}buying.index[z], linestyle = \PYZsq{}\PYZhy{}\PYZhy{}\PYZsq{}, linewidth = 1, 
                                   \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{red}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Sell}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{sign\PYZus{}before} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}
            \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].axvspan(stock\PYZus{}buying.index[z], stock\PYZus{}buying.index[z+1], 
                               \PY{n}{facecolor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.2}\PY{p}{)}

    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].legend([\PYZsq{}Price\PYZsq{},\PYZsq{}MA 20\PYZsq{},\PYZsq{}MA 50\PYZsq{},\PYZsq{}Buy\PYZsq{},\PYZsq{}Sell\PYZsq{}], loc=\PYZsq{}upper left\PYZsq{})

\PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}    
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_204_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    We can see a big difference in comparison to the data without outliers.
There are several occasions where we change the strategy from buying to
selling or vice versa in comparison to the graphs without outliers. This
shows that the mean is not robust against outliers.

    \hypertarget{section}{%
\paragraph{4.4.2}\label{section}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{497}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj. Closure Moving Average}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=} \PY{l+m+mi}{15}\PY{p}{)}

\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{stock} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{all\PYZus{}stocks}\PY{p}{)}\PY{p}{:}
    \PY{k}{if} \PY{n}{i} \PY{o}{\PYZgt{}} \PY{l+m+mi}{1}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{1}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{0}
    
    \PY{n}{stock\PYZus{}rolling\PYZus{}20} \PY{o}{=} \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{)}\PY{o}{.}\PY{n}{median}\PY{p}{(}\PY{p}{)}
    \PY{n}{stock\PYZus{}rolling\PYZus{}50} \PY{o}{=} \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{50}\PY{p}{)}\PY{o}{.}\PY{n}{median}\PY{p}{(}\PY{p}{)}
    \PY{n}{stock\PYZus{}buying}\PY{o}{.}\PY{n}{index} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{to\PYZus{}datetime}\PY{p}{(}\PY{n}{stock\PYZus{}rolling\PYZus{}20}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{l+m+mi}{49}\PY{p}{:}\PY{p}{]}\PY{p}{)}
    \PY{n}{stock\PYZus{}buying} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sign}\PY{p}{(}\PY{p}{(}\PY{n}{stock\PYZus{}rolling\PYZus{}20} \PY{o}{\PYZhy{}} \PY{n}{stock\PYZus{}rolling\PYZus{}50}\PY{p}{)}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}\PY{p}{)}

    \PY{n}{stock}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{49}\PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{ax} \PY{o}{=} \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}], grid = True, 
                            \PY{n}{title} \PY{o}{=} \PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{ylabel}\PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(stock\PYZus{}rolling\PYZus{}20[49:], alpha = 0.6, color =\PYZsq{}r\PYZsq{}, linewidth=0.5, label=\PYZsq{}MA 20\PYZsq{})
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(stock\PYZus{}rolling\PYZus{}50, alpha = 0.6, color =\PYZsq{}purple\PYZsq{}, linewidth=0.5, label=\PYZsq{}MA 50\PYZsq{})
    \PY{n}{sign\PYZus{}before} \PY{o}{=} \PY{n}{stock\PYZus{}buying}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
    
    \PY{k}{for} \PY{n}{z}\PY{p}{,} \PY{n}{value} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{stock\PYZus{}buying}\PY{p}{[}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{:}
        \PY{k}{if} \PY{n}{value} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{:}
            \PY{k}{if} \PY{n}{sign\PYZus{}before} \PY{o}{==} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{:}
                \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].axvline(stock\PYZus{}buying.index[z], linestyle = \PYZsq{}\PYZhy{}\PYZhy{}\PYZsq{}, linewidth = 1, 
                                   \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Buy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{sign\PYZus{}before} \PY{o}{=} \PY{l+m+mi}{1}
            \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].axvspan(stock\PYZus{}buying.index[z], stock\PYZus{}buying.index[z+1], 
                               \PY{n}{facecolor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.2}\PY{p}{)}
        \PY{k}{else}\PY{p}{:}
            \PY{k}{if} \PY{n}{sign\PYZus{}before} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{:}
                \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].axvline(stock\PYZus{}buying.index[z], linestyle = \PYZsq{}\PYZhy{}\PYZhy{}\PYZsq{}, linewidth = 1, 
                                   \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{red}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Sell}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{sign\PYZus{}before} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}
            \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].axvspan(stock\PYZus{}buying.index[z], stock\PYZus{}buying.index[z+1], 
                               \PY{n}{facecolor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.2}\PY{p}{)}

    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].legend([\PYZsq{}Price\PYZsq{},\PYZsq{}MA 20\PYZsq{},\PYZsq{}MA 50\PYZsq{},\PYZsq{}Buy\PYZsq{},\PYZsq{}Sell\PYZsq{}], loc=\PYZsq{}lower left\PYZsq{})

\PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}    
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_207_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{508}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj. Closure Moving Average With Outliers}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=} \PY{l+m+mi}{15}\PY{p}{)}
\PY{n}{outlier\PYZus{}dates} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2018\PYZhy{}07\PYZhy{}27}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2018\PYZhy{}09\PYZhy{}14}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2018\PYZhy{}11\PYZhy{}5}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2018\PYZhy{}12\PYZhy{}14}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{2019\PYZhy{}01\PYZhy{}14}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}

\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{stock} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{all\PYZus{}stocks}\PY{p}{)}\PY{p}{:}
    \PY{k}{if} \PY{n}{i} \PY{o}{\PYZgt{}} \PY{l+m+mi}{1}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{1}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{0}
        
    \PY{n}{stock\PYZus{}modified} \PY{o}{=} \PY{n}{stock}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}
    \PY{n}{outliers\PYZus{}value\PYZus{}max} \PY{o}{=} \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{max}\PY{p}{(}\PY{p}{)}
    \PY{n}{outliers\PYZus{}value\PYZus{}min} \PY{o}{=} \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{min}\PY{p}{(}\PY{p}{)}
    
    \PY{k}{for} \PY{n}{counter}\PY{p}{,} \PY{n}{date} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{outlier\PYZus{}dates}\PY{p}{)}\PY{p}{:}
        \PY{k}{if} \PY{n}{counter}\PY{o}{\PYZpc{}}\PY{k}{2} == 1:
            \PY{n}{current\PYZus{}value} \PY{o}{=} \PY{n}{outliers\PYZus{}value\PYZus{}max}\PY{o}{*}\PY{l+m+mf}{1.2}
        \PY{k}{else}\PY{p}{:}
            \PY{n}{current\PYZus{}value} \PY{o}{=} \PY{n}{outliers\PYZus{}value\PYZus{}min}\PY{o}{*}\PY{l+m+mf}{0.8}
            
        \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{n}{date}\PY{p}{]} \PY{o}{=} \PY{n}{current\PYZus{}value}
    
    \PY{n}{stock\PYZus{}rolling\PYZus{}20} \PY{o}{=} \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{20}\PY{p}{)}\PY{o}{.}\PY{n}{median}\PY{p}{(}\PY{p}{)}
    \PY{n}{stock\PYZus{}rolling\PYZus{}50} \PY{o}{=} \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{.}\PY{n}{rolling}\PY{p}{(}\PY{l+m+mi}{50}\PY{p}{)}\PY{o}{.}\PY{n}{median}\PY{p}{(}\PY{p}{)}
    \PY{n}{stock\PYZus{}buying}\PY{o}{.}\PY{n}{index} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{to\PYZus{}datetime}\PY{p}{(}\PY{n}{stock\PYZus{}rolling\PYZus{}20}\PY{o}{.}\PY{n}{index}\PY{p}{[}\PY{l+m+mi}{49}\PY{p}{:}\PY{p}{]}\PY{p}{)}
    \PY{n}{stock\PYZus{}buying} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{sign}\PY{p}{(}\PY{p}{(}\PY{n}{stock\PYZus{}rolling\PYZus{}20} \PY{o}{\PYZhy{}} \PY{n}{stock\PYZus{}rolling\PYZus{}50}\PY{p}{)}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)}\PY{p}{)}

    \PY{n}{stock\PYZus{}modified}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Adj Close}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{[}\PY{l+m+mi}{49}\PY{p}{:}\PY{p}{]}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{ax} \PY{o}{=} \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}], grid = True, 
                            \PY{n}{title} \PY{o}{=} \PY{n}{stock\PYZus{}names}\PY{p}{[}\PY{n}{i}\PY{p}{]}\PY{p}{,} \PY{n}{ylabel}\PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Price}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{color}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{blue}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{)}
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(stock\PYZus{}rolling\PYZus{}20[49:], alpha = 0.6, color =\PYZsq{}r\PYZsq{}, linewidth=0.5, label=\PYZsq{}MA 20\PYZsq{})
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].plot(stock\PYZus{}rolling\PYZus{}50, alpha = 0.6, color =\PYZsq{}purple\PYZsq{}, linewidth=0.5, label=\PYZsq{}MA 50\PYZsq{})
    \PY{n}{sign\PYZus{}before} \PY{o}{=} \PY{n}{stock\PYZus{}buying}\PY{p}{[}\PY{l+m+mi}{0}\PY{p}{]}
    
    \PY{k}{for} \PY{n}{z}\PY{p}{,} \PY{n}{value} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{stock\PYZus{}buying}\PY{p}{[}\PY{p}{:}\PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{]}\PY{p}{)}\PY{p}{:}
        \PY{k}{if} \PY{n}{value} \PY{o}{\PYZgt{}} \PY{l+m+mi}{0}\PY{p}{:}
            \PY{k}{if} \PY{n}{sign\PYZus{}before} \PY{o}{==} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}\PY{p}{:}
                \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].axvline(stock\PYZus{}buying.index[z], linestyle = \PYZsq{}\PYZhy{}\PYZhy{}\PYZsq{}, linewidth = 1, 
                                   \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{green}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Buy}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{sign\PYZus{}before} \PY{o}{=} \PY{l+m+mi}{1}
            \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].axvspan(stock\PYZus{}buying.index[z], stock\PYZus{}buying.index[z+1], 
                               \PY{n}{facecolor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{g}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.2}\PY{p}{)}
        \PY{k}{else}\PY{p}{:}
            \PY{k}{if} \PY{n}{sign\PYZus{}before} \PY{o}{==} \PY{l+m+mi}{1}\PY{p}{:}
                \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].axvline(stock\PYZus{}buying.index[z], linestyle = \PYZsq{}\PYZhy{}\PYZhy{}\PYZsq{}, linewidth = 1, 
                                   \PY{n}{alpha} \PY{o}{=} \PY{l+m+mf}{0.8}\PY{p}{,} \PY{n}{color} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{red}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{label} \PY{o}{=} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Sell}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
                \PY{n}{sign\PYZus{}before} \PY{o}{=} \PY{o}{\PYZhy{}}\PY{l+m+mi}{1}
            \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].axvspan(stock\PYZus{}buying.index[z], stock\PYZus{}buying.index[z+1], 
                               \PY{n}{facecolor}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{r}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{alpha}\PY{o}{=}\PY{l+m+mf}{0.2}\PY{p}{)}

    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].legend([\PYZsq{}Price\PYZsq{},\PYZsq{}MA 20\PYZsq{},\PYZsq{}MA 50\PYZsq{},\PYZsq{}Buy\PYZsq{},\PYZsq{}Sell\PYZsq{}], loc=\PYZsq{}upper left\PYZsq{})

\PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}    
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_208_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    In the exercises before we saw that the median is more robust in facing
outliers. This observation also gets verified here,the buying and
selling for the outlier data is mostly the same as the data without
outliers. Only for the JPM stock we get two areas that are different
from the graphs without outliers.

Comparing the mean and the median traiding models, we see that the
median leads to a much more outlier-robust buying and selling strategy
than the mean, since we have seen a bigger difference in strategy of the
mean strategy with and without outliers than for the median strategy
with and without outliers

    \hypertarget{graphs-in-finance}{%
\subsection{5 Graphs in Finance}\label{graphs-in-finance}}

    \hypertarget{section}{%
\subsubsection{5.1}\label{section}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{112}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Load data of stocks.}
\PY{n}{all\PYZus{}stocks} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{snp\PYZus{}allstocks\PYZus{}2015\PYZus{}2019.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{header} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{,} \PY{n}{index\PYZus{}col} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}
\PY{n}{all\PYZus{}stocks}\PY{o}{.}\PY{n}{index} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{to\PYZus{}datetime}\PY{p}{(}\PY{n}{all\PYZus{}stocks}\PY{o}{.}\PY{n}{index}\PY{p}{)}
\PY{n}{snp\PYZus{}info} \PY{o}{=} \PY{n}{pd}\PY{o}{.}\PY{n}{read\PYZus{}csv}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{snp\PYZus{}info.csv}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{index\PYZus{}col} \PY{o}{=} \PY{l+m+mi}{0}\PY{p}{)}
\PY{n}{portfolio\PYZus{}raw} \PY{o}{=} \PY{n}{snp\PYZus{}info}\PY{o}{.}\PY{n}{copy}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Symbol}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{113}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{portfolio\PYZus{}raw}
\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{113}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
                      Security SEC filings             GICS Sector  \textbackslash{}
Symbol
MMM                 3M Company     reports             Industrials
ABT        Abbott Laboratories     reports             Health Care
ABBV               AbbVie Inc.     reports             Health Care
ABMD               ABIOMED Inc     reports             Health Care
ACN              Accenture plc     reports  Information Technology
{\ldots}                        {\ldots}         {\ldots}                     {\ldots}
XYL                 Xylem Inc.     reports             Industrials
YUM            Yum! Brands Inc     reports  Consumer Discretionary
ZBH     Zimmer Biomet Holdings     reports             Health Care
ZION             Zions Bancorp     reports              Financials
ZTS                     Zoetis     reports             Health Care

                     GICS Sub Industry     Headquarters Location  \textbackslash{}
Symbol
MMM           Industrial Conglomerates       St. Paul, Minnesota
ABT              Health Care Equipment   North Chicago, Illinois
ABBV                   Pharmaceuticals   North Chicago, Illinois
ABMD             Health Care Equipment    Danvers, Massachusetts
ACN     IT Consulting \& Other Services           Dublin, Ireland
{\ldots}                                {\ldots}                       {\ldots}
XYL               Industrial Machinery    White Plains, New York
YUM                        Restaurants      Louisville, Kentucky
ZBH              Health Care Equipment           Warsaw, Indiana
ZION                    Regional Banks      Salt Lake City, Utah
ZTS                    Pharmaceuticals  Florham Park, New Jersey

       Date first added[3][4]      CIK      Founded
Symbol
MMM                       NaN    66740         1902
ABT                1964-03-31     1800         1888
ABBV               2012-12-31  1551152  2013 (1888)
ABMD               2018-05-31   815094         1981
ACN                2011-07-06  1467373         1989
{\ldots}                       {\ldots}      {\ldots}          {\ldots}
XYL                2011-11-01  1524472          NaN
YUM                1997-10-06  1041061          NaN
ZBH                2001-08-07  1136869          NaN
ZION               2001-06-22   109380          NaN
ZTS                2013-06-21  1555280          NaN

[505 rows x 8 columns]
\end{Verbatim}
\end{tcolorbox}
        
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{114}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{portfolio\PYZus{}selection} \PY{o}{=} \PY{n}{snp\PYZus{}info}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Date first added[3][4]}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
\PY{n}{portfolio\PYZus{}selection} \PY{o}{=} \PY{n}{portfolio\PYZus{}selection}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Symbol}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{portfolio\PYZus{}selection} \PY{o}{=} \PY{n}{portfolio\PYZus{}selection}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{portfolio\PYZus{}selection}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{GICS Sector}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Information Technology}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}

\PY{n}{portfolio\PYZus{}selection} \PY{o}{=} \PY{n}{portfolio\PYZus{}selection}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{10}\PY{p}{]}

\PY{n}{display}\PY{p}{(}\PY{n}{portfolio\PYZus{}selection}\PY{p}{)}

\PY{n}{stocks} \PY{o}{=} \PY{n}{portfolio\PYZus{}selection}\PY{o}{.}\PY{n}{index}

\PY{n}{returns} \PY{o}{=} \PY{n}{np}\PY{o}{.}\PY{n}{log}\PY{p}{(}\PY{n}{all\PYZus{}stocks}\PY{p}{[}\PY{n}{stocks}\PY{p}{]}\PY{p}{)}\PY{o}{.}\PY{n}{diff}\PY{p}{(}\PY{l+m+mi}{1}\PY{p}{)}\PY{o}{.}\PY{n}{fillna}\PY{p}{(}\PY{l+m+mf}{0.0}\PY{p}{)} 

\PY{n}{plt}\PY{o}{.}\PY{n}{plot}\PY{p}{(}\PY{n}{returns}\PY{o}{.}\PY{n}{cumsum}\PY{p}{(}\PY{p}{)}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{ylabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cummulative Log Return}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{xlabel}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Dates}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{plt}\PY{o}{.}\PY{n}{title}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Cummulative Log Return for Chosen Stocks}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{grid}\PY{p}{(}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{legend}\PY{p}{(}\PY{n}{stocks}\PY{p}{,} \PY{n}{loc}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{upper left}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    
    \begin{Verbatim}[commandchars=\\\{\}]
                              Security SEC filings             GICS Sector  \textbackslash{}
Symbol                                                                       
MXIM     Maxim Integrated Products Inc     reports  Information Technology   
JKHY       Jack Henry \& Associates Inc     reports  Information Technology   
KEYS             Keysight Technologies     reports  Information Technology   
FTNT                          Fortinet     reports  Information Technology   
ANET                   Arista Networks     reports  Information Technology   
FLT          FleetCor Technologies Inc     reports  Information Technology   
BR      Broadridge Financial Solutions     reports  Information Technology   
IPGP               IPG Photonics Corp.     reports  Information Technology   
CDNS            Cadence Design Systems     reports  Information Technology   
ANSS                             ANSYS     reports  Information Technology   

                            GICS Sub Industry     Headquarters Location  \textbackslash{}
Symbol                                                                    
MXIM                           Semiconductors      San Jose, California   
JKHY    Data Processing \& Outsourced Services          Monett, Missouri   
KEYS       Electronic Equipment \& Instruments    Santa Rosa, California   
FTNT                         Systems Software     Sunnyvale, California   
ANET                 Communications Equipment   Santa Clara, California   
FLT     Data Processing \& Outsources Services         Norcross, Georgia   
BR      Data Processing \& Outsourced Services    Lake Success, New York   
IPGP        Electronic Manufacturing Services     Oxford, Massachusetts   
CDNS                     Application Software      San Jose, California   
ANSS                     Application Software  Canonsburg, Pennsylvania   

       Date first added[3][4]      CIK Founded  
Symbol                                          
MXIM               2018-12-03   743316    1983  
JKHY               2018-11-13  1262439     NaN  
KEYS               2018-11-06  1601046    2014  
FTNT               2018-10-11  1262039    2000  
ANET               2018-08-28  1596532    2004  
FLT                2018-06-20  1175454    2000  
BR                 2018-06-18  1383312    1962  
IPGP               2018-03-07  1111928     NaN  
CDNS               2017-09-18   813672     NaN  
ANSS               2017-06-19  1013462    1969  
    \end{Verbatim}

    
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_214_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    I thought about choosing a portfolio rule that gives me back a good
overall return. Therefore my thoughts were to choose the 10 assets of
the companies with the newest date of addition to the index in the area
of information technology, since IT is a sector that performed well
overall in the last couple of years and I expect from newer companies to
be more innovative and have more potential to grow than older companies.
And the intuition we get from the graph is that this portfolio indeed
performed pretty well also in comparison to the other stocks.

    \hypertarget{section}{%
\subsubsection{5.2}\label{section}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{115}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{import} \PY{n+nn}{networkx} \PY{k}{as} \PY{n+nn}{nx}
\end{Verbatim}
\end{tcolorbox}

    Bellow we see the heat map of our correlation matrix. The correlation of
the stocks shows some differences, but there are no negatively
correlated stocks nor uncorrelated stocks, all stocks are correlated to
some degree. All stock correlation values are in the range of 0.28 to
0.57. We would expect such a correlation, since we choose stocks only in
the IT sector and this tend to follow same trends.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{116}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{corr} \PY{o}{=} \PY{n}{returns}\PY{o}{.}\PY{n}{corr}\PY{p}{(}\PY{p}{)}
\PY{n}{sn}\PY{o}{.}\PY{n}{heatmap}\PY{p}{(}\PY{n}{corr}\PY{p}{,} \PY{n}{annot}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_219_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{117}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Transform it in a links data frame (3 columns only):}
\PY{n}{links} \PY{o}{=} \PY{n}{corr}\PY{o}{.}\PY{n}{stack}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{reset\PYZus{}index}\PY{p}{(}\PY{p}{)}
\PY{n}{links}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{values} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.0}\PY{p}{,} \PY{l+m+mf}{0.3}\PY{p}{,} \PY{l+m+mf}{0.4}\PY{p}{,} \PY{l+m+mf}{0.5}\PY{p}{]}
 
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Correlations Networks with Different Minimum Correlations}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=} \PY{l+m+mi}{25}\PY{p}{)}
    
\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{value} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{values}\PY{p}{)}\PY{p}{:} 
    \PY{k}{if} \PY{n}{i} \PY{o}{\PYZgt{}} \PY{l+m+mi}{1}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{1}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{0}
        
    \PY{c+c1}{\PYZsh{} Keep only correlation over a threshold and remove self correlation (cor(A,A)=1)}
    \PY{n}{links\PYZus{}filtered}\PY{o}{=}\PY{n}{links}\PY{o}{.}\PY{n}{loc}\PY{p}{[} \PY{p}{(}\PY{n}{links}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{n}{value}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{links}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{n}{links}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)} \PY{p}{]}
 
    \PY{c+c1}{\PYZsh{} Build your graph}
    \PY{n}{G} \PY{o}{=} \PY{n}{nx}\PY{o}{.}\PY{n}{from\PYZus{}pandas\PYZus{}edgelist}\PY{p}{(}\PY{n}{links\PYZus{}filtered}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{edge\PYZus{}attr}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{edges} \PY{o}{=} \PY{n}{G}\PY{o}{.}\PY{n}{edges}\PY{p}{(}\PY{p}{)}
    \PY{n}{min\PYZus{}val} \PY{o}{=} \PY{n+nb}{min}\PY{p}{(}\PY{n}{links}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
    \PY{n}{weights} \PY{o}{=} \PY{p}{[}\PY{n+nb}{int}\PY{p}{(}\PY{p}{(}\PY{p}{(}\PY{n}{G}\PY{p}{[}\PY{n}{u}\PY{p}{]}\PY{p}{[}\PY{n}{v}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZhy{}}\PY{n}{min\PYZus{}val}\PY{p}{)}\PY{o}{*}\PY{l+m+mi}{30}\PY{p}{)}\PY{p}{)} \PY{k}{for} \PY{n}{u}\PY{p}{,}\PY{n}{v} \PY{o+ow}{in} \PY{n}{edges}\PY{p}{]}
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].set\PYZus{}title(\PYZsq{}Minimum Correlation value: \PYZsq{}+ str(value))
    
    \PY{c+c1}{\PYZsh{} Plot the network:}
    \PY{n}{nx}\PY{o}{.}\PY{n}{draw}\PY{p}{(}\PY{n}{G}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}], with\PYZus{}labels=True, node\PYZus{}color=\PYZsq{}orange\PYZsq{}, edge\PYZus{}color=\PYZsq{}lightblue\PYZsq{}, width=weights, linewidths=30, font\PYZus{}size=10)
    \PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_220_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Here we see the graphs of the correlation values for different
thresholds of correlation. On the upper left we see the graph with all
the stocks and all correlations. On the bottom right only the ones that
are correlated with a value of more than 0.5. In addition the edges are
also showing the correlation: the thicker the edge, the bigger the
correlation.

    \hypertarget{section}{%
\subsubsection{5.3}\label{section}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{118}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Transform it in a links data frame (3 columns only):}
\PY{n}{links} \PY{o}{=} \PY{n}{corr}\PY{o}{.}\PY{n}{stack}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{reset\PYZus{}index}\PY{p}{(}\PY{p}{)}
\PY{n}{links}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{values} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.0}\PY{p}{,} \PY{l+m+mf}{0.3}\PY{p}{,} \PY{l+m+mf}{0.35}\PY{p}{,} \PY{l+m+mf}{0.4}\PY{p}{]}
 
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Correlations Networks with Different Minimum Correlations}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=} \PY{l+m+mi}{25}\PY{p}{)}
    
\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{value} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{values}\PY{p}{)}\PY{p}{:} 
    \PY{k}{if} \PY{n}{i} \PY{o}{\PYZgt{}} \PY{l+m+mi}{1}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{1}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{0}
        
    \PY{c+c1}{\PYZsh{} Keep only correlation over a threshold and remove self correlation (cor(A,A)=1)}
    \PY{n}{links\PYZus{}filtered}\PY{o}{=}\PY{n}{links}\PY{o}{.}\PY{n}{loc}\PY{p}{[} \PY{p}{(}\PY{n}{links}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{n}{value}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{links}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{n}{links}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)} \PY{p}{]}
    \PY{n}{links\PYZus{}filtered}\PY{o}{=}\PY{n}{links\PYZus{}filtered}\PY{o}{.}\PY{n}{sample}\PY{p}{(}\PY{n}{frac}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Build your graph}
    \PY{n}{G} \PY{o}{=} \PY{n}{nx}\PY{o}{.}\PY{n}{from\PYZus{}pandas\PYZus{}edgelist}\PY{p}{(}\PY{n}{links\PYZus{}filtered}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{edge\PYZus{}attr}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{edges} \PY{o}{=} \PY{n}{G}\PY{o}{.}\PY{n}{edges}\PY{p}{(}\PY{p}{)}
    \PY{n}{min\PYZus{}val} \PY{o}{=} \PY{n+nb}{min}\PY{p}{(}\PY{n}{links}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
    \PY{n}{weights} \PY{o}{=} \PY{p}{[}\PY{n+nb}{int}\PY{p}{(}\PY{p}{(}\PY{p}{(}\PY{n}{G}\PY{p}{[}\PY{n}{u}\PY{p}{]}\PY{p}{[}\PY{n}{v}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZhy{}}\PY{n}{min\PYZus{}val}\PY{p}{)}\PY{o}{*}\PY{l+m+mi}{40}\PY{p}{)}\PY{p}{)} \PY{k}{for} \PY{n}{u}\PY{p}{,}\PY{n}{v} \PY{o+ow}{in} \PY{n}{edges}\PY{p}{]}
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].set\PYZus{}title(\PYZsq{}Minimum Correlation value: \PYZsq{}+ str(value))
    
    \PY{c+c1}{\PYZsh{} Plot the network:}
    \PY{n}{nx}\PY{o}{.}\PY{n}{draw}\PY{p}{(}\PY{n}{G}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}], with\PYZus{}labels=True, node\PYZus{}color=\PYZsq{}orange\PYZsq{}, edge\PYZus{}color=\PYZsq{}lightblue\PYZsq{}, node\PYZus{}size=210, width=weights, linewidths=30, font\PYZus{}size=10)
    \PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_223_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    With the \texttt{links\_filtered=links\_filtered.sample(frac=1)} command
we can shuffle our graph vertices but we still get the same result, as
expected, since the correlation coefficients remain the same. That's
because correlation is independent from data reordering and therefore
also if we shuffle the dates of our underlining data, we will still get
the same correlation coefficients and edge weights and the same
information in our graphs. Just the visual representation would change,
since the networkx module does not have a deterministic plotting.

    \hypertarget{section}{%
\subsubsection{5.4}\label{section}}

    After searching through some papers, dynamic time warping has been
proposed multiple times. For reference
\[\textit{ Similarity Measure Selection for Clustering Stock Market Time Series Databases
, Dr.S.Radhimeenakshi, K.Latha}\]

\[ \textit{A Novel Time-Sensitive Composite Similarity Model for Multivariate Time-Series Correlation Analysis,
Mengxia Liang
, Xiaolong Wang , and Shaocong Wu}\]

Dynamic time warping calculates an optimal match between two given time
series, with certain restrictions and rules, which can be found here:
https://en.wikipedia.org/wiki/Dynamic\_time\_warping For us it's
important to note, that we also work with different time series and
since different stocks may have warying time, dynamic time warping
offers a good metric.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{119}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k+kn}{from} \PY{n+nn}{fastdtw} \PY{k+kn}{import} \PY{n}{fastdtw}
\PY{k+kn}{from} \PY{n+nn}{scipy}\PY{n+nn}{.}\PY{n+nn}{spatial}\PY{n+nn}{.}\PY{n+nn}{distance} \PY{k+kn}{import} \PY{n}{euclidean}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{120}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{similarity\PYZus{}mat} \PY{o}{=} \PY{n}{corr}

\PY{c+c1}{\PYZsh{} Go through tickers}
\PY{k}{for} \PY{n}{t\PYZus{}idx} \PY{o+ow}{in} \PY{n}{returns}\PY{o}{.}\PY{n}{columns}\PY{p}{:}
    \PY{k}{for} \PY{n}{t\PYZus{}col} \PY{o+ow}{in} \PY{n}{returns}\PY{o}{.}\PY{n}{columns}\PY{p}{:}
        \PY{n}{distance}\PY{p}{,} \PY{n}{path} \PY{o}{=} \PY{n}{fastdtw}\PY{p}{(}\PY{n}{returns}\PY{p}{[}\PY{n}{t\PYZus{}idx}\PY{p}{]}\PY{p}{,} \PY{n}{returns}\PY{p}{[}\PY{n}{t\PYZus{}col}\PY{p}{]}\PY{p}{,} \PY{n}{dist}\PY{o}{=}\PY{n}{euclidean}\PY{p}{)}
        \PY{n}{similarity\PYZus{}mat}\PY{p}{[}\PY{n}{t\PYZus{}idx}\PY{p}{]}\PY{p}{[}\PY{n}{t\PYZus{}col}\PY{p}{]} \PY{o}{=} \PY{n}{distance}    
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{121}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{sn}\PY{o}{.}\PY{n}{heatmap}\PY{p}{(}\PY{n}{similarity\PYZus{}mat}\PY{p}{,} \PY{n}{annot}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_229_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{122}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Transform it in a links data frame (3 columns only):}
\PY{n}{links} \PY{o}{=} \PY{n}{similarity\PYZus{}mat}\PY{o}{.}\PY{n}{stack}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{reset\PYZus{}index}\PY{p}{(}\PY{p}{)}
\PY{n}{links}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{values} \PY{o}{=} \PY{p}{[}\PY{l+m+mf}{0.0}\PY{p}{,} \PY{l+m+mi}{9}\PY{p}{,} \PY{l+m+mi}{12}\PY{p}{,} \PY{l+m+mi}{14}\PY{p}{]}
 
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Correlations Networks with Different Minimum Correlations}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=} \PY{l+m+mi}{25}\PY{p}{)}
    
\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{value} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{values}\PY{p}{)}\PY{p}{:} 
    \PY{k}{if} \PY{n}{i} \PY{o}{\PYZgt{}} \PY{l+m+mi}{1}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{1}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{0}
        
    \PY{c+c1}{\PYZsh{} Keep only correlation over a threshold and remove self correlation (cor(A,A)=1)}
    \PY{n}{links\PYZus{}filtered}\PY{o}{=}\PY{n}{links}\PY{o}{.}\PY{n}{loc}\PY{p}{[} \PY{p}{(}\PY{n}{links}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{n}{value}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{links}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{n}{links}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)} \PY{p}{]}
    \PY{n}{links\PYZus{}filtered}\PY{o}{=}\PY{n}{links\PYZus{}filtered}\PY{o}{.}\PY{n}{sample}\PY{p}{(}\PY{n}{frac}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Build your graph}
    \PY{n}{G} \PY{o}{=} \PY{n}{nx}\PY{o}{.}\PY{n}{from\PYZus{}pandas\PYZus{}edgelist}\PY{p}{(}\PY{n}{links\PYZus{}filtered}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{edge\PYZus{}attr}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{edges} \PY{o}{=} \PY{n}{G}\PY{o}{.}\PY{n}{edges}\PY{p}{(}\PY{p}{)}
    \PY{n}{min\PYZus{}val} \PY{o}{=} \PY{n+nb}{min}\PY{p}{(}\PY{n}{links}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
    \PY{n}{weights} \PY{o}{=} \PY{p}{[}\PY{n+nb}{int}\PY{p}{(}\PY{p}{(}\PY{p}{(}\PY{n}{G}\PY{p}{[}\PY{n}{u}\PY{p}{]}\PY{p}{[}\PY{n}{v}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZhy{}}\PY{n}{min\PYZus{}val}\PY{p}{)}\PY{p}{)}\PY{o}{*}\PY{l+m+mf}{0.5}\PY{p}{)} \PY{k}{for} \PY{n}{u}\PY{p}{,}\PY{n}{v} \PY{o+ow}{in} \PY{n}{edges}\PY{p}{]}
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].set\PYZus{}title(\PYZsq{}Minimum Correlation value: \PYZsq{}+ str(value))
    
    \PY{c+c1}{\PYZsh{} Plot the network:}
    \PY{n}{nx}\PY{o}{.}\PY{n}{draw}\PY{p}{(}\PY{n}{G}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}], with\PYZus{}labels=True, node\PYZus{}color=\PYZsq{}orange\PYZsq{}, edge\PYZus{}color=\PYZsq{}lightblue\PYZsq{}, node\PYZus{}size=250, width=weights, linewidths=30, font\PYZus{}size=10)
    \PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_230_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Now we will shuffle the series and plot the graphs again.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{123}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{shuffled\PYZus{}returns} \PY{o}{=} \PY{n}{returns}\PY{o}{.}\PY{n}{sample}\PY{p}{(}\PY{n}{frac}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{,}\PY{n}{axis}\PY{o}{=}\PY{l+m+mi}{0}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{124}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{k}{for} \PY{n}{t\PYZus{}idx} \PY{o+ow}{in} \PY{n}{shuffled\PYZus{}returns}\PY{o}{.}\PY{n}{columns}\PY{p}{:}
    \PY{k}{for} \PY{n}{t\PYZus{}col} \PY{o+ow}{in} \PY{n}{shuffled\PYZus{}returns}\PY{o}{.}\PY{n}{columns}\PY{p}{:}
        \PY{n}{distance}\PY{p}{,} \PY{n}{path} \PY{o}{=} \PY{n}{fastdtw}\PY{p}{(}\PY{n}{shuffled\PYZus{}returns}\PY{p}{[}\PY{n}{t\PYZus{}idx}\PY{p}{]}\PY{p}{,} \PY{n}{shuffled\PYZus{}returns}\PY{p}{[}\PY{n}{t\PYZus{}col}\PY{p}{]}\PY{p}{,} \PY{n}{dist}\PY{o}{=}\PY{n}{euclidean}\PY{p}{)}
        \PY{n}{similarity\PYZus{}mat}\PY{p}{[}\PY{n}{t\PYZus{}idx}\PY{p}{]}\PY{p}{[}\PY{n}{t\PYZus{}col}\PY{p}{]} \PY{o}{=} \PY{n}{distance}  
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{125}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{sn}\PY{o}{.}\PY{n}{heatmap}\PY{p}{(}\PY{n}{similarity\PYZus{}mat}\PY{p}{,} \PY{n}{annot}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_234_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{126}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{c+c1}{\PYZsh{} Transform it in a links data frame (3 columns only):}
\PY{n}{links} \PY{o}{=} \PY{n}{similarity\PYZus{}mat}\PY{o}{.}\PY{n}{stack}\PY{p}{(}\PY{p}{)}\PY{o}{.}\PY{n}{reset\PYZus{}index}\PY{p}{(}\PY{p}{)}
\PY{n}{links}\PY{o}{.}\PY{n}{columns} \PY{o}{=} \PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}
\PY{n}{values} \PY{o}{=} \PY{p}{[}\PY{l+m+mi}{0}\PY{p}{,} \PY{l+m+mi}{9}\PY{p}{,} \PY{l+m+mi}{12}\PY{p}{,} \PY{l+m+mi}{14}\PY{p}{]}
 
\PY{n}{fig}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{plt}\PY{o}{.}\PY{n}{subplots}\PY{p}{(}\PY{l+m+mi}{2}\PY{p}{,}\PY{l+m+mi}{2}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{set\PYZus{}size\PYZus{}inches}\PY{p}{(}\PY{l+m+mi}{15}\PY{p}{,}\PY{l+m+mi}{8}\PY{p}{)}
\PY{n}{fig}\PY{o}{.}\PY{n}{suptitle}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Correlations Networks with Different Minimum Correlations}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{fontsize}\PY{o}{=} \PY{l+m+mi}{25}\PY{p}{)}
    
\PY{k}{for} \PY{n}{i}\PY{p}{,} \PY{n}{value} \PY{o+ow}{in} \PY{n+nb}{enumerate}\PY{p}{(}\PY{n}{values}\PY{p}{)}\PY{p}{:} 
    \PY{k}{if} \PY{n}{i} \PY{o}{\PYZgt{}} \PY{l+m+mi}{1}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{1}
    \PY{k}{else}\PY{p}{:}
        \PY{n}{j}\PY{o}{=}\PY{l+m+mi}{0}
        
    \PY{c+c1}{\PYZsh{} Keep only correlation over a threshold and remove self correlation (cor(A,A)=1)}
    \PY{n}{links\PYZus{}filtered}\PY{o}{=}\PY{n}{links}\PY{o}{.}\PY{n}{loc}\PY{p}{[} \PY{p}{(}\PY{n}{links}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{\PYZgt{}} \PY{n}{value}\PY{p}{)} \PY{o}{\PYZam{}} \PY{p}{(}\PY{n}{links}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]} \PY{o}{!=} \PY{n}{links}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)} \PY{p}{]}
    \PY{n}{links\PYZus{}filtered}\PY{o}{=}\PY{n}{links\PYZus{}filtered}\PY{o}{.}\PY{n}{sample}\PY{p}{(}\PY{n}{frac}\PY{o}{=}\PY{l+m+mi}{1}\PY{p}{)}
    \PY{c+c1}{\PYZsh{} Build your graph}
    \PY{n}{G} \PY{o}{=} \PY{n}{nx}\PY{o}{.}\PY{n}{from\PYZus{}pandas\PYZus{}edgelist}\PY{p}{(}\PY{n}{links\PYZus{}filtered}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var1}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{var2}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{edge\PYZus{}attr}\PY{o}{=}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}
    \PY{n}{edges} \PY{o}{=} \PY{n}{G}\PY{o}{.}\PY{n}{edges}\PY{p}{(}\PY{p}{)}
    \PY{n}{min\PYZus{}val} \PY{o}{=} \PY{n+nb}{min}\PY{p}{(}\PY{n}{links}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{p}{)}
    \PY{n}{weights} \PY{o}{=} \PY{p}{[}\PY{n+nb}{int}\PY{p}{(}\PY{p}{(}\PY{p}{(}\PY{n}{G}\PY{p}{[}\PY{n}{u}\PY{p}{]}\PY{p}{[}\PY{n}{v}\PY{p}{]}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{value}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{\PYZhy{}}\PY{n}{min\PYZus{}val}\PY{p}{)}\PY{p}{)}\PY{o}{*}\PY{l+m+mf}{0.5}\PY{p}{)} \PY{k}{for} \PY{n}{u}\PY{p}{,}\PY{n}{v} \PY{o+ow}{in} \PY{n}{edges}\PY{p}{]}
    \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}].set\PYZus{}title(\PYZsq{}Minimum Correlation value: \PYZsq{}+ str(value))
    
    \PY{c+c1}{\PYZsh{} Plot the network:}
    \PY{n}{nx}\PY{o}{.}\PY{n}{draw}\PY{p}{(}\PY{n}{G}\PY{p}{,} \PY{n}{ax} \PY{o}{=} \PY{n}{ax}\PY{p}{[}\PY{n}{j}\PY{p}{]}\PY{p}{[}\PY{n}{i}\PY{o}{\PYZpc{}}\PY{k}{2}], with\PYZus{}labels=True, node\PYZus{}color=\PYZsq{}orange\PYZsq{}, edge\PYZus{}color=\PYZsq{}lightblue\PYZsq{}, node\PYZus{}size=250, width=weights, linewidths=30, font\PYZus{}size=10)
    \PY{n}{fig}\PY{o}{.}\PY{n}{tight\PYZus{}layout}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_235_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    This time, in contrary to the covariance metric, we get different
results through time series shuffling. This is the case since our new
metric is time dependent. We see this when we compare the heatmap graph
or if we closely examine the network graph. As an example, the CDNS
stock has a higher dynamic time wrapping simillarity to ANET then to
KEYS after shuffling. Before CDNS and KEYS had a higher simillarity.

    \hypertarget{section}{%
\subsubsection{5.5}\label{section}}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{129}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{portfolio\PYZus{}selection} \PY{o}{=} \PY{n}{snp\PYZus{}info}\PY{o}{.}\PY{n}{sort\PYZus{}values}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Date first added[3][4]}\PY{l+s+s1}{\PYZsq{}}\PY{p}{,} \PY{n}{ascending}\PY{o}{=}\PY{k+kc}{False}\PY{p}{)}
\PY{n}{portfolio\PYZus{}selection} \PY{o}{=} \PY{n}{portfolio\PYZus{}selection}\PY{o}{.}\PY{n}{set\PYZus{}index}\PY{p}{(}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Symbol}\PY{l+s+s1}{\PYZsq{}}\PY{p}{)}

\PY{n}{portfolio\PYZus{}selection} \PY{o}{=} \PY{n}{portfolio\PYZus{}selection}\PY{o}{.}\PY{n}{loc}\PY{p}{[}\PY{n}{portfolio\PYZus{}selection}\PY{p}{[}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{GICS Sector}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}\PY{o}{==}\PY{l+s+s1}{\PYZsq{}}\PY{l+s+s1}{Information Technology}\PY{l+s+s1}{\PYZsq{}}\PY{p}{]}

\PY{n}{portfolio\PYZus{}selection} \PY{o}{=} \PY{n}{portfolio\PYZus{}selection}\PY{p}{[}\PY{p}{:}\PY{l+m+mi}{10}\PY{p}{]}

\PY{n}{stocks} \PY{o}{=} \PY{n}{portfolio\PYZus{}selection}\PY{o}{.}\PY{n}{index}

\PY{n}{returns} \PY{o}{=} \PY{n}{all\PYZus{}stocks}\PY{p}{[}\PY{n}{stocks}\PY{p}{]}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)} 
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{133}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{corr} \PY{o}{=} \PY{n}{returns}\PY{o}{.}\PY{n}{corr}\PY{p}{(}\PY{p}{)}
\PY{n}{sn}\PY{o}{.}\PY{n}{heatmap}\PY{p}{(}\PY{n}{corr}\PY{p}{,} \PY{n}{annot}\PY{o}{=}\PY{k+kc}{True}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_239_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    Already in section one we have figured out that the raw prices are non
stationary and can thus have disadvantages in comparison to the
according log returns. Since the stock trend will influence the
correlation the most considering the raw data, the correlation values
will be higher than the ones of the log returns. That follows directly
from the non stationarity of the data and the underlying trends that are
contained in the raw data. We can also confirm that by looking at the
correlation matrix, which has much higher correlation values than seen
before. Therefore out network would be much stronger connected thatn
with considering only the covariance matrix of the log returns.

With using the dynamic time warping metric with the raw data we can
expect it to behave similary. Since we still got the mainly upward trend
in our data, this trend will be the main factor in distinguishing the
distance of certain stocks in this metric and will thus not be as
informative as the log return.

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{143}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{returns} \PY{o}{=} \PY{n}{all\PYZus{}stocks}\PY{p}{[}\PY{n}{stocks}\PY{p}{]}\PY{o}{.}\PY{n}{dropna}\PY{p}{(}\PY{p}{)} 
\PY{k}{for} \PY{n}{t\PYZus{}idx} \PY{o+ow}{in} \PY{n}{returns}\PY{o}{.}\PY{n}{columns}\PY{p}{:}
    \PY{k}{for} \PY{n}{t\PYZus{}col} \PY{o+ow}{in} \PY{n}{returns}\PY{o}{.}\PY{n}{columns}\PY{p}{:}
        \PY{n}{distance}\PY{p}{,} \PY{n}{path} \PY{o}{=} \PY{n}{fastdtw}\PY{p}{(}\PY{n}{returns}\PY{p}{[}\PY{n}{t\PYZus{}idx}\PY{p}{]}\PY{p}{,} \PY{n}{returns}\PY{p}{[}\PY{n}{t\PYZus{}col}\PY{p}{]}\PY{p}{,} \PY{n}{dist}\PY{o}{=}\PY{n}{euclidean}\PY{p}{)}
        \PY{n}{similarity\PYZus{}mat}\PY{p}{[}\PY{n}{t\PYZus{}idx}\PY{p}{]}\PY{p}{[}\PY{n}{t\PYZus{}col}\PY{p}{]} \PY{o}{=} \PY{n}{distance}  
\end{Verbatim}
\end{tcolorbox}

    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{144}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
\PY{n}{sn}\PY{o}{.}\PY{n}{heatmap}\PY{p}{(}\PY{n}{similarity\PYZus{}mat}\PY{p}{)}
\PY{n}{plt}\PY{o}{.}\PY{n}{show}\PY{p}{(}\PY{p}{)}
\end{Verbatim}
\end{tcolorbox}

    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_242_0.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{147}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]

\end{Verbatim}
\end{tcolorbox}

            \begin{tcolorbox}[breakable, size=fbox, boxrule=.5pt, pad at break*=1mm, opacityfill=0]
\prompt{Out}{outcolor}{147}{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]
<matplotlib.legend.Legend at 0x7fe9b6540ac0>
\end{Verbatim}
\end{tcolorbox}
        
    \begin{center}
    \adjustimage{max size={0.9\linewidth}{0.9\paperheight}}{Signal Processing and Machine Learning for Finance_latex_files/Signal Processing and Machine Learning for Finance_latex_243_1.png}
    \end{center}
    { \hspace*{\fill} \\}
    
    \begin{tcolorbox}[breakable, size=fbox, boxrule=1pt, pad at break*=1mm,colback=cellbackground, colframe=cellborder]
\prompt{In}{incolor}{ }{\boxspacing}
\begin{Verbatim}[commandchars=\\\{\}]

\end{Verbatim}
\end{tcolorbox}


    % Add a bibliography block to the postdoc
    
    
    
\end{document}
